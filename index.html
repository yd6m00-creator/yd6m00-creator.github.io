<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>๐ฐ ูุญุงูุงุฉ ุญุณูู ุณูุชุงุช (V36 - ุงููุฑูุถ ุงูุฏูููุฉ)</title>
    <style>
        :root{--bg:#071029;--card:#0b1220;--accent:#06b6d4;--success:#4ade80;--danger:#ff6b6b;--muted:#9aa4b2;--warn:#f59e0b;--info:#6366f1;--radius:8px;}
        body{font-family:system-ui,sans-serif;background:var(--bg);color:#e6eef6;margin:0;padding:15px;display:flex;flex-direction:column;gap:15px;}
        .container{max-width:650px;margin:0 auto;width:100%;}
        .card{background:var(--card);border-radius:var(--radius);padding:15px;box-shadow:0 4px 12px rgba(0,0,0,.3);margin-bottom:15px;}
        button,input[type=text],input[type=number]{padding:8px 12px;border-radius:5px;font-weight:600;transition:background .2s;border:none;box-sizing:border-box;}
        button{background:var(--accent);color:#021;cursor:pointer;}
        .action-btn{background:var(--success);color:#021;}
        .danger-btn{background:var(--danger);color:white;}
        .warn-btn{background:var(--warn);color:#021;}
        button:disabled{background:var(--muted);cursor:not-allowed;}
        .hidden{display:none!important;}
        .v-btn-group{display:flex;flex-direction:column;gap:10px;}
        .h-group{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
        .h-input-group{display:flex;align-items:center;gap:5px;}
        .stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:15px;margin-bottom:15px;}
        .stat-value{font-size:1.4em;font-weight:700;}
        .stat-label{font-size:.75em;color:var(--muted);}
        .loan-status{padding:10px;border:1px solid var(--danger);border-radius:var(--radius);margin-top:10px;}
        .loan-consequence{border:2px solid var(--danger);background:#200000;}
        .item-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,.1);}
        #mailIcon{font-size:1.5em;cursor:pointer;position:relative;transition: color 0.3s;}
        #mailIcon.unread {
            color: var(--danger);
        }
        #bankMailIcon{font-size:1.5em;cursor:pointer;position:relative;transition: color 0.3s;} /* ุฃููููุฉ ุงูุจูู */
        #bankMailIcon.unread {
            color: var(--danger);
        }
        #mailCount{position:absolute;top:-5px;right:-10px;background:var(--danger);color:white;border-radius:50%;padding:2px 6px;font-size:.6em;line-height:1;}
        #bankMailCount{position:absolute;top:-5px;right:-10px;background:var(--danger);color:white;border-radius:50%;padding:2px 6px;font-size:.6em;line-height:1;} /* ุนุฏุงุฏ ุงูุจูู */
        .admin-panel{border-top:2px solid var(--danger);margin-top:20px;padding-top:10px;}
        .morale-bar{height:8px;border-radius:4px;transition:width .5s;}
        .morale-stat{background:rgba(99,102,241,.1);padding:10px;border-radius:var(--radius);}
        #stat-header{display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(0,0,0,.3);border-radius:var(--radius);margin-bottom:15px;}
        .header-stat{text-align:center;font-size:.9em;}
        .header-stat .value{font-weight:700;font-size:1.1em;}
        /* ุงูุชุนุฏูู ุงูุฌุฏูุฏ: ุฎูููุฉ ุงูุจุฑูุฏ ุนูุฏ ุงููุชุญ */
        #mailPanel.red-bg {
            background: #200000; /* ุฃุญูุฑ ุฏุงูู */
            border: 1px solid var(--danger);
        }
        #bankMailPanel.red-bg {
            background: #200000; /* ุฃุญูุฑ ุฏุงูู */
            border: 1px solid var(--danger);
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="color:var(--accent);text-align:center;">Mini Centat V36 (ุชุญุฏู ุงููุฑูุถ ุงูุฏูููุฉ)</h2>
        <div id="stat-header">
            <div class="header-stat" style="color:var(--success);"><div id="h_money" class="value">0$</div><div class="label">ุงูุฑุตูุฏ ุงููุญูู</div></div>
            <div class="header-stat" style="color:var(--info);"><div id="h_bank" class="value">0$</div><div class="label">ุงูุจูู ุงููุฑูุฒู</div></div>
            <div class="header-stat" style="color:var(--warn);"><div id="h_points" class="value">0P</div><div class="label">ููุงุทู</div></div>
        </div>
        <div id="view-home" class="card">
            <h3>ุดุงุดุฉ ุงูุฏุฎูู</h3>
            <div class="v-btn-group">
                <button onclick="changeView('view-game')">ุงุจุฏุฃ ุงููุนุจ (ูุถุน ุงูุนุจ)</button>
                <button onclick="changeView('view-bank')">ุงูุจูู ุงููุฑูุฒู ๐ฆ</button> 
                <button onclick="changeView('view-black-market')" style="background:var(--danger); color:white;">ุงูุณูู ุงูุณูุฏุงุก ๐ฃ</button>
                <button onclick="changeView('view-farm')">ุงููุฒุฑุนุฉ ๐ฟ</button> 
                <button onclick="changeView('view-car')">ูุนุฑุถ ุงูุณูุงุฑุงุช</button>
                <button onclick="changeView('view-estate')">ุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช</button>
                <button onclick="changeView('view-phones')">ุณูู ุงูููุงุชู ๐ฒ</button>
                <button onclick="changeView('view-achievements')">ุงูุฅูุฌุงุฒุงุช ๐</button>
            </div>
            <div class="h-group admin-panel">
                <h4 style="margin:0;">ูุถุน ุงูุฃุฏูู</h4>
                <div class="h-input-group">
                    <input type="text" id="adminPass" placeholder="ูููุฉ ุงูุณุฑ" style="width:100px;">
                    <button id="adminBtn" class="danger-btn" onclick="toggleAdmin()">ุฏุฎูู</button>
                </div>
            </div>
            <div id="adminControls" class="v-btn-group hidden" style="margin-top:10px;">
                 <input type="number" id="cheatAmount" value="1000" style="width:100px;">
                 <button class="action-btn" onclick="applyCheat('money')">ุฅุถุงูุฉ ุฑุตูุฏ</button>
                 <button class="action-btn" onclick="applyCheat('points')">ุฅุถุงูุฉ ููุงุท</button>
                 <button class="danger-btn" onclick="S.breakTimer=0; alert('ุชู ุฅูุบุงุก ุงูุงุณุชุฑุงุญุฉ.'); uUI();">ุฅูุบุงุก ุงุณุชุฑุงุญุฉ ุงูุนูุงู ููุฑุงู</button>
            </div>
        </div>
        <div id="view-game" class="card hidden">
            <div class="h-group">
                <h3>ุฅุฏุงุฑุฉ ุงููุตูุน</h3>
                <span id="mailIcon" onclick="readMail()">๐ฉ<span id="mailCount" class="hidden">0</span></span>
            </div>
            <div id="mailPanel" class="card hidden">
                <h3 style="margin-top:0;">ุงูุจุฑูุฏ ุงููุงุฑุฏ ๐ฎ</h3>
                <div id="mailList"></div>
                <button onclick="readAllMail()" class="action-btn" style="width:100%; margin-top:10px;">ูุฑุฃุช ุงููู</button>
            </div>
            <div class="stat-grid">
                <div class="stat"><div id="debt" class="stat-value" style="color:var(--danger);">0</div><div class="stat-label">ุฅุฌูุงูู ุงูุฏูู</div></div>
                <div class="stat morale-stat" style="grid-column:span 2;"><div id="moralePercent" class="stat-value">100%</div><div class="stat-label">ุฑุถุง ุงูุนูุงู</div><div class="morale-bar-container" style="margin-top:5px;"><div id="moraleBar" class="morale-bar" style="width:100%;"></div></div></div>
                <div class="stat"><div id="power" class="stat-value">0</div><div class="stat-label">ุงูุทุงูุฉ ุงููุชุจููุฉ (MW)</div></div>
                <div class="stat" style="background:rgba(99,102,241,.1);"><div id="workers_extra" class="stat-value">0</div><div class="stat-label">ุนูุงู ูุงุฆุถ</div></div>
                <div class="stat" style="background:rgba(74,222,128,.1);"><div id="machines_running" class="stat-value">0</div><div class="stat-label">ุขูุงุช ุนุงููุฉ</div></div>
            </div>
            <p id="statusMsg" style="font-weight:700;text-align:center;color:var(--warn);"></p>
            <div class="card" style="margin-bottom:15px;">
                <h3>๐๏ธ ุงููุตูุน ูุงูุนูุงู</h3>
                <div class="h-group">
                    <button id="collectBtn" class="action-btn">ุฌูุน ูุฏูู (+1 ููุทุฉ)</button> 
                    <button id="convertBtn" class="warn-btn">ุชุญููู ุงูููุงุท (100P = 1$)</button>
                </div>
                <div class="h-group" style="border-top:1px dashed var(--muted);padding-top:10px;">
                    <h4>ุชุฑููุฉ ุงููุนูู (ูุณุชูู <span id="factoryLvl">1</span>)</h4>
                    <button id="upgradeFactoryBtn"></button>
                </div>
                <div class="h-group"><h4>ุชูุธูู ุนุงูู (20 ุฑุตูุฏ)</h4> <button id="buyWorkerBtn">ุชูุธูู</button></div>
                <div class="h-group"><h4>ุตุฑู ุทุนุงู ุงูุนูุงู (100 ุฑุตูุฏ)</h4> <button id="feedWorkerBtn" class="action-btn">ุตุฑู</button></div>
                <h4>ุดุฑุงุก ุขูุงุช (ุชุชุทูุจ ุนุงูู ูุทุงูุฉ)</h4>
                <div id="machineList"></div>
            </div>
            <div id="loanPanel" class="card" style="margin-bottom:15px;">
                <h3>๐ฆ ูุธุงู ุงููุฑูุถ</h3>
                <div id="smallLoans">
                    <h4>ูุฑูุถ ุงููุตูุน ุงูุณุฑูุนุฉ (ูุงุฆุฏุฉ ุฏูุฑูุฉ)</h4>
                    <div class="h-group">
                        <button onclick="takeSmallLoan(500, .5)" id="loan500Btn">ูุฑุถ 500$ (+50% ูุงุฆุฏุฉ)</button>
                        <button onclick="takeSmallLoan(250, .25)" id="loan250Btn">ูุฑุถ 250$ (+25% ูุงุฆุฏุฉ)</button>
                    </div>
                    <div id="smallLoanStatus" class="h-group hidden" style="margin-top:10px;">
                        <p style="color:var(--danger);font-weight:700;margin:0;">ุฏูู ุงููุตูุน: <span id="currentSmallDebt">0</span> $</p>
                        <button onclick="repaySmallLoan()" class="action-btn" id="repaySmallLoanBtn">ุณุฏุงุฏ ุงูุฏูู ุจุงููุงูู</button>
                    </div>
                </div>
                <div id="bigLoanForm" class="card" style="margin-bottom:0;">
                    <h4>ูุฑุถ ุงูุณูู ุงููุจูุฑ (ูุคูุช ุณุฏุงุฏ)</h4>
                    <p style="font-size:.8em;color:var(--muted);">ุงููุฑุถ ุจูู 10,000$ ู 2,000,000$. ุงููุงุฆุฏุฉ ุงูุฃุณุงุณูุฉ: 100%.</p>
                    <div class="h-group">
                        <label for="bigLoanAmount" style="font-weight:700;">ุงููุจูุบ:</label>
                        <input type="number" id="bigLoanAmount" value="10000" min="10000" max="2000000" style="width:100px;">
                        <span>ุฑุตูุฏ ($)</span>
                    </div>
                    <div class="h-group" style="margin-top:5px;">
                        <label for="extraTime" style="font-weight:700;">ุชูุฏูุฏ ุงูููุช:</label>
                        <input type="number" id="extraTime" value="0" min="0" max="30" style="width:50px;">
                        <span>ุฏูููุฉ ุฅุถุงููุฉ (+1% ูุงุฆุฏุฉ/ุฏูููุฉ)</span>
                    </div>
                    <button onclick="takeBigLoan()" class="danger-btn" style="width:100%;margin-top:10px;">ุงุฎุฐ ุงููุฑุถ ุงููุจูุฑ</button>
                </div>
                <div id="bigLoanStatus" class="loan-status hidden">
                    <h4 style="color:var(--danger);margin-top:0;">ูุถุน ุงููุฑุถ ุงููุจูุฑ ุงููุดุท (ุณุฏุงุฏ ุจุงูุฏูุนุงุช)</h4>
                    <p>ุงููุจูุบ ุงููุชุจูู: <span id="currentLoanAmount" style="color:var(--danger);">0</span> $</p>
                    <p>ุฅุฌูุงูู ุงูุณุฏุงุฏ ุงููุชุจูู: <span id="totalRepayAmount" style="color:var(--danger);">0</span> $ (ูุงุฆุฏุฉ: <span id="currentInterestRate">0</span>%)</p>
                    <p>ุงูููุช ุงููุชุจูู: <span id="bigLoanTimer" style="color:var(--warn);">--</span></p>
                    <div class="h-group" style="border-top:1px dashed var(--muted);padding-top:10px;"><span style="font-weight:700;">ุงูุญุฏ ุงูุฃุฏูู ููุฏูุนุฉ:</span><span id="minPaymentAmount" style="color:var(--info);">0</span> $ (10% ูู ุงููุชุจูู)</div>
                    <div class="h-group">
                        <input type="number" id="repayAmount" value="0" min="0" style="width:100px;">
                        <button onclick="repayBigLoan(.10)" class="action-btn">ุฏูุน 10% ุฏูุนุฉ</button>
                        <button onclick="repayBigLoan(0)" class="action-btn">ุณุฏุงุฏ ุงููุจูุบ ุงููุญุฏุฏ</button>
                    </div>
                </div>
                <div id="loanConsequence" class="card loan-consequence hidden">
                    <h4 style="color:var(--danger);margin-top:0;">๐ด ุงูุชูู ููุช ุงูุณุฏุงุฏ!</h4>
                    <p style="margin-bottom:15px;">ูุฌุจ ุงุชุฎุงุฐ ูุฑุงุฑ ููุฑู ูุชุฌูุจ ุงูุนูุงูุจ.</p>
                    <div class="v-btn-group">
                        <button class="warn-btn" onclick="applyPenalty(1)">ุบุฑุงูุฉ 10000$ + ุฒูุงุฏุฉ ูุงุฆุฏุฉ 10% (ุชูุฏูุฏ)</button>
                        <button class="danger-btn" onclick="applyPenalty(2)">ูุตุงุฏุฑุฉ ุฌููุน ุงูููุชููุงุช ูุงูุฃููุงู (ุฅุนุงุฏุฉ ุชุนููู)</button>
                    </div>
                </div>
            </div>
            <div class="card" style="margin-bottom:15px;">
                <h3>๐ ูุญุทุงุช ุงูุทุงูุฉ (โ๏ธ <span id="powerFailureStatus" style="color:var(--danger);">ูุง ุชูุฌุฏ ุฃุนุทุงู</span>)</h3>
                <div id="powerList"></div>
            </div>
            <div class="card" style="margin-bottom:15px;">
                <h3>๐ฐ ุจูู ุงูููุงุท (ุงูุนูุงุฑุงุช)</h3>
                <div class="h-group">
                    <p style="margin:0;font-weight:700;">ููุงุท ุงูุฑุจุญ ุงูููุฌูุนุฉ: <span id="bankP" style="color:var(--success);">0</span> ููุทุฉ</p>
                    <button id="collectBankPBtn" class="action-btn">ุฌูุน ุงููู</button>
                </div>
            </div>
            <button onclick="changeView('view-home')">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        <div id="view-estate" class="card hidden">
            <h3>ุฅุฏุงุฑุฉ ุงูุนูุงุฑุงุช</h3>
            <p>ููุงุท ุงูุฑุจุญ ูู ุงูุนูุงุฑุงุช ุชุฐูุจ ุฅูู ุจูู ุงูููุงุท.</p>
            <div id="estateList"></div>
            <button onclick="changeView('view-home')">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        <div id="view-car" class="card hidden">
            <h3>ูุนุฑุถ ุงูุณูุงุฑุงุช / ุงูุนุฑูุถ</h3>
            <p style="color:var(--danger);font-weight:700;">โ๏ธ ุชุญุฐูุฑ: ุฅุฐุง ุฑูุถุช ุงูุนุฑุถ ุงูุฎุงูุณุ ุณุชุชู ูุตุงุฏุฑุฉ ุงูุณูุงุฑุฉ.</p>
            <div id="carList"></div>
            <button onclick="changeView('view-home')">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        <div id="view-achievements" class="card hidden">
            <h3>ุงูุฅูุฌุงุฒุงุช ๐</h3>
            <p>ุฃููู ูุฐู ุงูุชุญุฏูุงุช ููุญุตูู ุนูู ููุงูุขุช ููุฏูุฉ ููุฑูุฉ.</p>
            <div id="achievementsList"></div>
            <button onclick="changeView('view-home')">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        <div id="view-bank" class="card hidden">
            <div class="h-group">
                <h3>ุงูุจูู ุงููุฑูุฒู ๐ฆ</h3>
                <span id="bankMailIcon" onclick="readBankMail()">โ๏ธ<span id="bankMailCount" class="hidden">0</span></span>
            </div>
            <p style="color:var(--info);">ููุงู ุขูู ูุฅูุฏุงุน ุฃููุงูู ูุญูุงูุชูุง ูู ูุฎุงุทุฑ ุงููุฑูุถ ุงููุจูุฑุฉ.</p>

            <div id="bankMailPanel" class="card hidden">
                <h4 style="margin-top:0;">ุทูุจุงุช ุงููุฑูุถ ุงูุฏูููุฉ ๐</h4>
                <p style="font-size:.8em;color:var(--warn);margin-bottom:10px;">
                    ูุคุดุฑ ุงูุซูุฉ ุงูุฏูููุฉ: <span id="internationalTrustDisplay" style="font-weight:700;color:var(--info);">100%</span>
                    <button id="restoreTrustBtn" onclick="restoreInternationalTrust()" style="margin-right:10px;" disabled>ุฏูุน ุบุฑุงูุฉ (10k$)</button>
                </p>
                <div id="internationalLoanList"></div>
                <button onclick="readAllBankMail()" class="action-btn" style="width:100%; margin-top:10px;">ุฅุฎูุงุก ุงููู</button>
            </div>
            <div class="stat-grid">
                <div class="stat"><div id="bankBalance" class="stat-value" style="color:var(--info);">0</div><div class="stat-label">ุฑุตูุฏู ูู ุงูุจูู ($)</div></div>
                <div class="stat" style="background:rgba(74,222,128,.1);"><div id="carProfit" class="stat-value" style="color:var(--success);">0</div><div class="stat-label">ุฅุฌูุงูู ุฃุฑุจุงุญ ุงูุณูุงุฑุงุช</div></div>
                <div class="stat" style="background:rgba(245,158,11,.1);"><div id="bankFee" class="stat-value" style="color:var(--danger);">0.1%</div><div class="stat-label">ุฑุณูู ุงูุณุญุจ</div></div>
            </div>
             <div class="h-group" style="border-top:1px dashed var(--muted);padding-top:10px;">
                <p style="font-weight:700;color:var(--success);margin:0;">ุฃุฑุจุงุญ ุงูุณูุงุฑุงุช: <span id="carProfitDisplay" style="font-size:1.1em;">0$</span></p>
                <button class="action-btn" onclick="resetCarProfit()">ุฅุนุงุฏุฉ ุชุนููู ุนุฏุงุฏ ุงูุฃุฑุจุงุญ</button>
            </div>
            <div class="card" style="margin-top:15px;margin-bottom:15px;">
                <h4>ุฅูุฏุงุน ุงูุฃููุงู</h4>
                <div class="h-input-group">
                    <input type="number" id="depositAmount" value="100" min="1" style="width:150px;">
                    <button class="action-btn" onclick="transferMoney('deposit')">ุฅูุฏุงุน</button>
                    <button class="action-btn" onclick="transferMoney('deposit',!0)">ุฅูุฏุงุน ุงููู</button>
                </div>
            </div>
            <div class="card" style="margin-bottom:15px;">
                <h4>ุณุญุจ ุงูุฃููุงู (ุฑุณูู: 0.1%)</h4>
                <div class="h-input-group">
                    <input type="number" id="withdrawAmount" value="100" min="1" style="width:150px;">
                    <button class="danger-btn" onclick="transferMoney('withdraw')">ุณุญุจ</button>
                    <button class="danger-btn" onclick="transferMoney('withdraw',!0)">ุณุญุจ ุงููู</button>
                </div>
            </div>

            <div id="activeInternationalLoans" class="card hidden">
                <h4>ุงููุฑูุถ ุงูุฏูููุฉ ุงููุดุทุฉ (ูู)</h4>
                <div id="activeInternationalLoanList"></div>
            </div>

            <button onclick="changeView('view-home')">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        <div id="view-farm" class="card hidden">
            <h3>ุงููุฒุฑุนุฉ ๐ฟ</h3>
            <p>ุงุฒุฑุน ุงูุจุฐูุฑ ูุงูุชุธุฑ ุญุชู ุงูุญุตุงุฏ ูุชุญุตู ุนูู ุฃุฑุจุงุญ ุชุฐูุจ ูุจุงุดุฑุฉ ุฅูู ุงูุจูู ุงููุฑูุฒู.</p>
            <div class="h-group">
                <h4 style="color:var(--success);margin:0;">ุณุนุฑ ุงูุจุฐุฑุฉ ุงููุงุญุฏุฉ: 100$</h4>
                <h4 style="color:var(--warn);margin:0;">ุฑุจุญ ุงูุญุตุงุฏ: 0.7%</h4>
            </div>
            <div class="card" id="plantingSection" style="background:rgba(74,222,128,.05);">
                <h4>ุดุฑุงุก ุงูุจุฐูุฑ ูุงูุฒุฑุงุนุฉ</h4>
                <div class="h-input-group" style="margin-bottom:10px;">
                    <input type="number" id="seedAmount" value="1" min="1" style="width:100px;">
                    <button class="action-btn" onclick="plantSeeds(parseInt($('seedAmount').value))">ุดุฑุงุก ุงููููุฉ ุงููุญุฏุฏุฉ</button>
                </div>
                <div class="h-input-group" style="justify-content:space-between;">
                    <button class="action-btn" onclick="plantSeeds(10)">ุดุฑุงุก 10 ุจุฐูุฑ (1k$)</button>
                    <button class="action-btn" onclick="plantSeeds(100)">ุดุฑุงุก 100 ุจุฐุฑุฉ (10k$)</button>
                    <button class="action-btn" onclick="plantSeeds(1000)">ุดุฑุงุก 1000 ุจุฐุฑุฉ (100k$)</button>
                </div>
                <div class="h-group" style="margin-top:15px; border-top:1px dashed var(--muted); padding-top:10px;">
                    <p style="font-weight:700;color:var(--success);margin:0;">ุญุตุงุฏ ูู ุงูุฌุงูุฒ</p>
                    <button class="action-btn" onclick="harvestAllReady()">ุญุตุงุฏ ุงููู</button>
                </div>
            </div>
            <div id="farmList" style="margin-top:15px;"></div>
            <button onclick="changeView('view-home')">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        
        <div id="view-phones" class="card hidden">
            <h3>ุณูู ุงูููุงุชู ๐ฒ</h3>
            <p>ูู ุจุดุฑุงุก ุงูููููุงุชุ ุชุตููุน ุงูุฃุฌูุฒุฉุ ูุชูุจูุฉ ุทูุจุงุช ุงูุณูู ุงููุชููุจุฉ ูุชุญููู ุฃุฑุจุงุญ ุถุฎูุฉ.</p>
            
            <div class="stat-grid" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));">
                <div class="stat" style="background:rgba(239,68,68,.1);"><div id="phone_parts" class="stat-value">0</div><div class="stat-label">ูุทุน (750$/ู)</div></div>
                <div class="stat" style="background:rgba(251,191,36,.1);"><div id="phone_batteries" class="stat-value">0</div><div class="stat-label">ุจุทุงุฑูุงุช (250$/ุจ)</div></div>
                <div class="stat" style="background:rgba(99,102,241,.1);"><div id="phone_stock" class="stat-value">0</div><div class="stat-label">ููุงุชู ุฌุงูุฒุฉ</div></div>
                <div class="stat" style="background:rgba(74,222,128,.1);"><div id="phone_machine_count" class="stat-value">0</div><div class="stat-label">ุขูุงุช ุชุตููุน</div></div>
            </div>

            <div class="card" style="margin-top:15px;">
                <h3>ุขูุงุช ุงูุชุตููุน (ุขูุฉ ูุงุญุฏุฉ: <span id="phoneMachineCostDisplay">5000$</span>)</h3>
                <div class="h-group">
                    <p>ูู ุขูุฉ ุชุตูุน ูุงุชู ูู 30 ุซุงููุฉ.</p>
                    <button id="buyPhoneMachineBtn" onclick="buyPhoneMachine()" disabled>ุดุฑุงุก ุขูุฉ</button>
                </div>
            </div>
             <div class="card" style="margin-top:15px;">
                <h3>ุณุนุฉ ุงูุชุฎุฒูู ูุงูุฅูุชุงุฌ ๐พ</h3>
                <div class="h-group">
                    <p style="margin:0;">ุงูุณุนุฉ ุงูุญุงููุฉ: <span id="phone_storage_capacity" style="font-weight:700;">1</span> ูุงุชู.</p>
                    <button id="buyStorageBtn" onclick="buyPhoneStorage()">ุดุฑุงุก ูุณุงุญุฉ ูุงุชู ูุงุญุฏ (500$)</button>
                </div>
                <p style="font-size:.8em;color:var(--danger);margin-top:5px;">โ๏ธ ูุง ูููู ุจุฏุก ุงูุชุตููุน ุฅุฐุง ุชุฌุงูุฒ ุงููุฎุฒูู ุงูุญุงูู ุงูุณุนุฉ ุงููุชุงุญุฉ.</p>
            </div>


            <div class="card" id="supplySection">
                <h3>ุดุฑุงุก ุงูููููุงุช (1000$ ููุชุฌููุนุฉ)</h3>
                <div class="h-input-group" style="margin-bottom:10px;">
                    <label for="componentAmount" style="font-weight:700;">ุนุฏุฏ ุงูุชุฌููุนุงุช:</label>
                    <input type="number" id="componentAmount" value="1" min="1" style="width:70px;">
                    <button class="action-btn" onclick="orderComponents()">ุทูุจ ุงูููููุงุช</button>
                </div>
                <div id="shipmentStatus" style="font-size:.8em;color:var(--warn);">ูุง ุชูุฌุฏ ุดุญูุงุช ูุงุฏูุฉ.</div>
            </div>
            
            <div class="card" id="productionSection">
                <h3>ุฎุท ุงูุฅูุชุงุฌ</h3>
                <div id="productionList"></div>
                <div class="h-group" style="margin-top:10px;">
                    <p style="margin:0;">ุชุญุชุงุฌ (1 ูุทุนุฉ + 1 ุจุทุงุฑูุฉ) ูุฅูุชุงุฌ ูุงุชู.</p>
                    <button id="startProductionBtn" onclick="startPhoneProduction()" disabled>ุจุฏุก ุงูุชุตููุน</button>
                </div>
                 <p style="font-size:.8em;color:var(--danger);margin-top:5px;">ุชูููุฉ ุตูุงูุฉ ุงููุฎุฒูู: 25$ ููู ูุงุชู ุฌุงูุฒ ูู ุฏูููุฉ.</p>
            </div>
            
            <div class="card" id="salesSection">
                <h3>ุณูู ุงูุทูุจุงุช ุงููุชููุจุฉ</h3>
                <div id="orderStatus"></div>
                <div class="h-group" style="margin-top:10px;">
                    <button id="sellPhonesBtn" onclick="sellPhones()" disabled>ุชูููุฐ ุงูุทูุจ ู ุงูุจูุน</button>
                </div>
            </div>

            <button onclick="changeView('view-home')" style="margin-top:15px;">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>

        <div id="view-black-market" class="card hidden">
            <h3 style="color:var(--danger);">ุงูุณูู ุงูุณูุฏุงุก ูุงูุชูููููุฌูุง ุงูุนุณูุฑูุฉ ๐ฃ</h3>
            <p>ุณูุณูุฉ ุฅูุชุงุฌ ุนุงููุฉ ุงููุฎุงุทุฑ/ุงูููุงูุฃุฉ. ุฌููุน ุงูุชุนุงููุงุช ุงููุงููุฉ ุชุชู ุนุจุฑ ุงูุจูู ุงููุฑูุฒู.</p>
            
            <div class="stat-grid" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));">
                <div class="stat" style="background:rgba(255,107,107,.1);"><div id="bm_tension" class="stat-value">0.50</div><div class="stat-label">ูุคุดุฑ ุงูุชูุชุฑ (ูุญุฏุฏ ุงูุณุนุฑ)</div></div>
                <div class="stat" style="background:rgba(255,191,36,.1);"><div id="bm_exposure" class="stat-value">0%</div><div class="stat-label">ูุคุดุฑ ุงูุชุนุฑุถ ููุฎุทุฑ</div></div>
                <div class="stat" style="background:rgba(99,102,241,.1);"><div id="bm_price" class="stat-value">0$</div><div class="stat-label">ุณุนุฑ ุงูุจูุน ุงูุญุงูู/ูุญุฏุฉ</div></div>
                <div class="stat" style="background:rgba(74,222,128,.1);"><div id="bm_units" class="stat-value">0</div><div class="stat-label">ูุฎุฒูู ุงูุณูุงุญ ุงูุฌุงูุฒ</div></div>
            </div>

            <div class="card" style="margin-top:15px; background: #200000;">
                <h3>ุงููุฑุญูุฉ 1: ุดุฑุงุก ุงูุชูููููุฌูุง (ูู ุงูุจูู ุงููุฑูุฒู)</h3>
                <div class="h-group">
                    <p style="margin:0;">ุงููุฎุทุทุงุช ุงูุณุฑูุฉ: <span id="bm_blueprint_status">โ ูุง ููุฌุฏ</span></p>
                    <button id="buyBlueprintsBtn" onclick="buyBlueprints()">ุดุฑุงุก (500k$)</button>
                </div>
                <div class="h-group">
                    <p style="margin:0;">ุชุฑุฎูุต ุงูุชุตุฏูุฑ: <span id="bm_license_status">โ ูุง ููุฌุฏ</span></p>
                    <button id="buyLicenseBtn" onclick="buyExportLicense()">ุดุฑุงุก (50k$)</button>
                </div>
            </div>

            <div class="card" style="margin-top:15px;">
                <h3>ุงููุฑุญูุฉ 2: ุงูุฅูุชุงุฌ ูุงูุชุฌููุน (ุงุณุชููุงู P)</h3>
                <div class="h-group">
                    <p style="margin:0;">ุขูุงุช ุงูุชุฌููุน: <span id="bm_lines_count">0</span></p>
                    <button id="buyAssemblyLineBtn" onclick="buyAssemblyLine()">ุดุฑุงุก ุฎุท ุชุฌููุน (200k$)</button>
                </div>
                 <div class="h-group" style="margin-top:10px; border-top:1px dashed var(--muted); padding-top:10px;">
                    <p style="margin:0; font-weight:700;">ุชูููุฉ ุงูุชุตููุน: 20,000P ููู ูุญุฏุฉ.</p>
                    <button id="startWeaponProductionBtn" onclick="startWeaponProduction()">ุจุฏุก ุงูุฅูุชุงุฌ</button>
                </div>
            </div>
            
            <div class="card" style="margin-top:15px;">
                <h3>ุงููุฑุญูุฉ 3: ุงูุชุตุฏูุฑ ูุงููุถุงุฑุจุฉ (ุฑุจุญ ููุจูู ุงููุฑูุฒู)</h3>
                <div class="h-group">
                    <p style="margin:0; font-weight:700;">ุณุนุฑ ุงููุญุฏุฉ: <span id="bm_current_price_export" style="color:var(--info);">0$</span></p>
                    <button id="exportWeaponsBtn" onclick="exportWeapons()">ุชุตุฏูุฑ ูุฎุฒูู ุงูุฃุณูุญุฉ ุจุงููุงูู</button>
                </div>
            </div>

            <button onclick="changeView('view-home')" style="margin-top:15px;">ุงูุนูุฏุฉ ูููุงุฆูุฉ</button>
        </div>
        </div> 
    <script>
        let S = {
            m: 1e3, p: 0, w: 0, machines: [], power: 0, debt: 0, loanA: 0,
            bigLoan: { amount: 0, initial: 0, totalRepay: 0, timer: 0, interest: 0, active: !1, initialTotalRepay: 0, initialTimer: 0 },
            cOwned: [], eOwned: [], bankP: 0, offersCount: 0, factoryLvl: 1, upgradeCost: 2500, breakTimer: 0, currentView: 'view-home', admin: !1, adminPass: '1234', morale: 100, isStrike: !1, flashSale: { active: !1, timer: 0, nextMinute: 0 }, achievements: {},
            bank: { balance: 0 }, farm: [], carProfit: 0,
            mailMessages: [], 
            phones: {
                machine: { count: 0, cost: 5000 }, parts: 0, batteries: 0, cost: 1000, production: [], stock: 0, storageCapacity: 1, storageCost: 500, maintenanceCost: 25, currentOrder: null, orderTimer: 0, nextOrderCheck: 60,
            },
            shipments: [], 
            blackMarket: {
                hasBlueprints: false, isFlawedBlueprint: false, assemblyLines: 0, weaponUnits: 0, exportLicense: false, tensionIndex: 0.5, exposure: 0,
                blueprintCost: 500000, assemblyCost: 200000, licenseCost: 50000, pCostPerUnit: 20000, baseExportPrice: 500000
            },
            // ๐ ูุธุงู ุงููุฑูุถ ุงูุฏูููุฉ ุงูุฌุฏูุฏ
            internationalLoans: {
                trustIndex: 100, // ูุคุดุฑ ุงูุซูุฉ (10% ุฎุทุฑ ุงููุตุงุฏุฑุฉ)
                trustPenaltyCost: 10000,
                activeRequests: [], // ุทูุจุงุช ุงููุฑูุถ ุงูุชู ุชุญุชุงุฌ ูููุฑุงุฑ
                myActiveLoans: [] // ุงููุฑูุถ ุงูุชู ูุฏูุชูุง ููุง ุฒุงูุช ููุฏ ุงูุณุฏุงุฏ
            },
            bankMailCount: 0, // ุนุฏุงุฏ ุฑุณุงุฆู ุจุฑูุฏ ุงูุจูู
        };
        
        const W_COST=20,FOOD_COST=100,MORALE_DROP_PER_MIN=5,BASE_P_TO_M=100,FLASH_SALE_P_TO_M=10,FLASH_SALE_DURATION=5,FLASH_SALE_MAX_WAIT=15,FLASH_SALE_MIN_WAIT=1,BANK_WITHDRAWAL_FEE=.001,SEED_COST=100,FARM_GROWTH_MIN=600,FARM_GROWTH_MAX=900,FARM_PROFIT_RATE=.007;
        const CAR_OFFER_MIN_WAIT=300, CAR_OFFER_MAX_WAIT=800; 
        const MACHINES=[{id:1,name:"ุฅูุชุงุฌ ุฎููู",cost:100,pPerMin:500,powerConsume:1,isPower:!1},{id:2,name:"ุฅูุชุงุฌ ูุชูุณุท",cost:500,pPerMin:1e3,powerConsume:3,isPower:!1},{id:101,name:"ูููุฏ ุฃุณุงุณู",cost:150,powerPerMin:10,isPower:!0,failureTime:0}];
        
        // ๐ ุชุญุฏูุซ ุงูุณูุงุฑุงุช (ุฅุถุงูุฉ 5 ุฌุฏูุฏุฉ)
        const CARS=[
            {id:1,name:"ุณุงูุจุง",price:100},{id:2,name:"ุณุชูุชุฉ",price:150},{id:3,name:"ุฌููู ุนุงุฏูุฉ",price:200},{id:4,name:"ููุง ุฑูู",price:300},{id:5,name:"ููููุฏุงู ุฅููุชุฑุง",price:400},{id:6,name:"ุชูููุชุง ูุงูุฑู",price:550},{id:7,name:"ููุฑุฏ ููุณุชุงูุฌ ูุฏููุฉ",price:700},{id:8,name:"ูุฑุณูุฏุณ E-Class",price:850},{id:9,name:"ุจู ุฅู ุฏุจููู X5",price:900},{id:10,name:"ุฏูุฏุฌ ุชุดุงููุฌุฑ",price:1e3},
            {id:11,name:"ุฌูุจ ุฌุฑุงูุฏ ุดูุฑููู",price:2500},{id:12,name:"ุจูุฑุด ูุงููู",price:3500},{id:13,name:"ุฑูุฌ ุฑููุฑ ูููุงุฑ",price:5000},{id:14,name:"ูุงูุจูุฑุฌููู ุฃูุฑูุณ",price:7500},{id:15,name:"ููุฑุงุฑู ุฑููุง",price:1e4},
            // ุงูุณูุงุฑุงุช ุงูุฌุฏูุฏุฉ
            {id:16,name:"ูุงุฒูุฑุงุชู ูููุงูุชู",price:15000},{id:17,name:"ุจูุชูู ุจูุชุงูุบุง",price:20000},{id:18,name:"ุฃุณุชูู ูุงุฑุชู DB11",price:30000},{id:19,name:"ูุงููุงุฑูู 720S",price:40000},{id:20,name:"ุจูุบุงุชู ููุฑูู",price:50000}
        ];
        
        // ๐ ุชุญุฏูุซ ุงูุนูุงุฑุงุช (ุฅุถุงูุฉ ููุฏู ูููุชุฌุน)
        const ESTATES=[
            {id:1,name:"ุจูุช ุดุนุจู ุตุบูุฑ",price:100,rentPerMin:100},{id:2,name:"ุจูุช ุนุงุฏู",price:250,rentPerMin:300},{id:3,name:"ุดูุฉ ุงุณุชุซูุงุฑูุฉ",price:500,rentPerMin:650},{id:4,name:"ูููุง ุตุบูุฑุฉ",price:750,rentPerMin:1050},{id:5,name:"ุนูุงุฑุฉ ุชุฌุงุฑูุฉ",price:1e3,rentPerMin:1500},
            // ุงูุนูุงุฑุงุช ุงูุฌุฏูุฏุฉ
            {id:6,name:"ููุฏู ุณูุงุญู ูุงุฎุฑ",price:100000,rentPerMin:150000},
            {id:7,name:"ููุชุฌุน ูุงุฎุฑ (850k P)",price:500000,rentPerMin:850000}
        ];
        
        const ACHIEVEMENTS=[{id:'startRich',name:'ุจุฏุงูุฉ ุงูุซุฑุงุก (10K ุฑุตูุฏ)',check:()=>S.m>=1e4,reward:500,achieved:!1},{id:'firstUpgrade',name:'ุงูุชุฑููุฉ ุงูุฃููู (ูุณุชูู 2)',check:()=>S.factoryLvl>=2,reward:1e3,achieved:!1},{id:'carCollector',name:'ุฌุงูุน ุงูุณูุงุฑุงุช (3 ุณูุงุฑุงุช)',check:()=>S.cOwned.length>=3,reward:2e3,achieved:!1},{id:'estateOwner',name:'ุฅูุจุฑุงุทูุฑ ุงูุนูุงุฑุงุช (5 ุนูุงุฑุงุช)',check:()=>S.eOwned.length>=5,reward:2500,achieved:!1},{id:'millionaire',name:'ุตุงุญุจ ุงูููุงููู (1M ุฑุตูุฏ)',check:()=>S.m>=1e6,reward:1e4,achieved:!1},{id:'powerMaster',name:'ุณูุฏ ุงูุทุงูุฉ (5 ูููุฏุงุช)',check:()=>S.machines.filter(m=>m.isPower).length>=5,reward:1500,achieved:!1},{id:'soldPoints',name:'ุชุงุฌุฑ ุณุฑูุน (50K ููุทุฉ)',check:()=>S.p>=5e4,reward:2e3,achieved:!1}];
        ACHIEVEMENTS.forEach(ach=>S.achievements[ach.id]=!1);

        // ๐ ุฃุณูุงุก ุงูุฏูู ูููุฑูุถ ุงูุฏูููุฉ
        const COUNTRIES = [
            'ุงูุฌูููุฑูุฉ ุงูููุฏุฑุงููุฉ', 'ููููุฉ ุงูุฌููุจ', 'ุฏููุฉ ุงูุฒูุฑุฏ', 'ุงูุฃุฑุถ ุงูุดูุงููุฉ', 'ุฅูุงุฑุฉ ุงูุณุงุญู',
            'ุงูุงุชุญุงุฏ ุงูููุญุฏ', 'ุฌูููุฑูุฉ ุงูุดูู', 'ุงูููุงุทุนุฉ ุงูุญุฑุฉ', 'ุจูุงุฏ ุงูุฃูู', 'ุฅูููู ุงููุฌูู',
            'ุงููุฏููุฉ ุงูุฌุฏูุฏุฉ', 'ูุงุฏู ุงูุดูุณ', 'ุดุจู ุงูุฌุฒูุฑุฉ ุงููุณุชููุฉ', 'ุงูุฌุฒุฑ ุงูุจุนูุฏุฉ', 'ุงููุฑูุฒ ุงููุงูู'
        ];

        const $ = id => document.getElementById(id);
        
        function formatNumber(num,fixed=2){num=Math.round(num*100)/100;if(num>=1e9)return(num/1e9).toFixed(1).replace(/\.0$/,'')+'B';if(num>=1e6)return(num/1e6).toFixed(1).replace(/\.0$/,'')+'M';if(num>=1e3)return(num/1e3).toFixed(1).replace(/\.0$/,'')+'k';return num.toFixed(fixed).replace(/\.00$/,'');}
        function formatTime(totalSeconds){const minutes=Math.floor(totalSeconds/60);const seconds=totalSeconds%60;return `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;}
        function generateNextOfferTime(){return Math.floor(Math.random()*(CAR_OFFER_MAX_WAIT-CAR_OFFER_MIN_WAIT+1))+CAR_OFFER_MIN_WAIT;} 
        function generateOfferValue(basePrice){const factor=.01+Math.random()*1.79;return Math.max(1,Math.floor(basePrice*factor));}
        
        // --- ูุธุงุฆู ุงูุจุฑูุฏ ุงููุตูุน ุงูุนุงุฏูุฉ ---
        window.readMail = () => {
            const mailPanel = $('mailPanel');
            const isHidden = mailPanel.classList.toggle('hidden');
            if (!isHidden) {
                mailPanel.classList.add('red-bg'); 
            } else {
                mailPanel.classList.remove('red-bg'); 
            }
            uMailList(); 
            uUI();
        };

        window.readAllMail = () => {
            S.mailMessages = []; 
            S.offersCount = 0; 
            $('mailPanel').classList.remove('red-bg'); 
            uMailList();
            uUI();
            $('mailPanel').classList.add('hidden'); 
        };

        function addMailMessage(type, message) {
            const allowedTypes = ['ุนุฑุถ ุณูุงุฑุฉ', 'ุดุญูุฉ ูุงุชู (ูุตูู)', 'ุญุตุงุฏ ูุฒุฑุนุฉ (ุฌุงูุฒ)', 'ุทูุจ ูุงุชู (ุฌุฏูุฏ)', 'ูุตุงุฏุฑุฉ ุณูุงุฑุฉ', 'ุงูุชุตุงุฏ ููู'];
            
            if (allowedTypes.includes(type)) {
                S.mailMessages.unshift({ type: type, message: message, timestamp: Date.now() });
                S.offersCount = S.mailMessages.length;
            }
        }

        function uMailList() {
            const list = $('mailList');
            list.innerHTML = '';
            if (S.mailMessages.length === 0) {
                list.insertAdjacentHTML('beforeend', `<p style="text-align:center;color:var(--muted);">ูุง ุชูุฌุฏ ุฑุณุงุฆู ุฌุฏูุฏุฉ.</p>`);
                return;
            }
            S.mailMessages.forEach(mail => {
                list.insertAdjacentHTML('beforeend', `
                    <div class="item-row" style="background:rgba(255,255,255,.05); border-radius:5px; margin-bottom:5px;">
                        <span style="font-weight:700; color:var(--info);">[${mail.type}]</span>
                        <span style="flex-grow:1; margin-right:10px;">${mail.message}</span>
                    </div>
                `);
            });
        }
        // --- ููุงูุฉ ูุธุงุฆู ุงูุจุฑูุฏ ุงููุตูุน ุงูุนุงุฏูุฉ ---

        // ๐ ูุธุงุฆู ุจุฑูุฏ ุงูุจูู ูุงููุฑูุถ ุงูุฏูููุฉ ุงูุฌุฏูุฏุฉ ---
        window.readBankMail = () => {
            const mailPanel = $('bankMailPanel');
            const isHidden = mailPanel.classList.toggle('hidden');
            if (!isHidden) {
                mailPanel.classList.add('red-bg'); 
            } else {
                mailPanel.classList.remove('red-bg'); 
            }
            uBankMailUI(); 
            uUI();
        };

        window.readAllBankMail = () => {
            $('bankMailPanel').classList.remove('red-bg'); 
            uUI();
            $('bankMailPanel').classList.add('hidden'); 
        };

        function addBankMailMessage(loanOffer) {
            S.internationalLoans.activeRequests.push(loanOffer);
            S.bankMailCount = S.internationalLoans.activeRequests.length;
        }

        function uBankMailUI() {
            const list = $('internationalLoanList');
            list.innerHTML = '';
            const activeRequests = S.internationalLoans.activeRequests;

            if ($('internationalTrustDisplay')) $('internationalTrustDisplay').textContent = `${S.internationalLoans.trustIndex.toFixed(0)}%`;
            if ($('restoreTrustBtn')) $('restoreTrustBtn').disabled = S.internationalLoans.trustIndex >= 100 || S.m < S.internationalLoans.trustPenaltyCost;
            if (S.internationalLoans.trustIndex < 25) $('internationalTrustDisplay').style.color = 'var(--danger)';
            else if (S.internationalLoans.trustIndex < 75) $('internationalTrustDisplay').style.color = 'var(--warn)';
            else $('internationalTrustDisplay').style.color = 'var(--success)';

            if (activeRequests.length === 0) {
                list.insertAdjacentHTML('beforeend', `<p style="text-align:center;color:var(--muted);">ูุง ุชูุฌุฏ ุทูุจุงุช ูุฑูุถ ุฏูููุฉ ุญุงููุงู.</p>`);
                return;
            }

            activeRequests.forEach((loan, index) => {
                const totalRepay = loan.amount * (1 + loan.interestRate);
                list.insertAdjacentHTML('beforeend', `
                    <div class="item-row" style="background:rgba(255,255,255,.05); border-radius:5px; margin-bottom:5px;">
                        <div style="flex-grow:1;">
                            <span style="font-weight:700; color:var(--info);">[${loan.country}] ูุทูุจ: ${formatNumber(loan.amount)}$</span>
                            <p style="font-size:.8em;margin:0;color:var(--muted);">ุงููุงุฆุฏุฉ: ${(loan.interestRate * 100).toFixed(1)}% | ุงูุณุฏุงุฏ: ${loan.timer / 60} ุฏูููุฉ.</p>
                            <p style="font-size:.8em;margin:0;color:var(--success);">ุฅุฌูุงูู ุงูุนุงุฆุฏ: ${formatNumber(totalRepay)}$</p>
                        </div>
                        <div class="h-input-group">
                            <button class="action-btn" onclick="respondToInternationalLoan(${index}, true)">ูุจูู</button>
                            <button class="danger-btn" onclick="respondToInternationalLoan(${index}, false)">ุฑูุถ</button>
                        </div>
                    </div>
                `);
            });
        }
        
        window.respondToInternationalLoan = (index, accepted) => {
            const loan = S.internationalLoans.activeRequests[index];
            if (!loan) return;

            if (accepted) {
                if (S.bank.balance < loan.amount) {
                    alert('ุฑุตูุฏู ูู ุงูุจูู ุงููุฑูุฒู ุบูุฑ ูุงูู ูุชูุฏูู ูุฐุง ุงููุฑุถ.');
                    return;
                }
                S.bank.balance -= loan.amount;
                const totalRepay = loan.amount * (1 + loan.interestRate);
                S.internationalLoans.myActiveLoans.push({
                    country: loan.country,
                    amount: loan.amount,
                    totalRepay: totalRepay,
                    timer: loan.timer,
                    id: Date.now()
                });
                alert(`โ ุชู ูุจูู ุงููุฑุถ! ุชู ุฎุตู ${formatNumber(loan.amount)}$ ูู ุงูุจูู ุงููุฑูุฒู. ุงูุณุฏุงุฏ ุงููุชููุน: ${formatNumber(totalRepay)}$`);
            } else {
                // ุนููุจุฉ ุงูุฑูุถ
                S.internationalLoans.trustIndex = Math.max(10, S.internationalLoans.trustIndex - 5);
                alert(`โ ุชู ุฑูุถ ุงููุฑุถ. ุงูุฎูุถ ูุคุดุฑ ุงูุซูุฉ ุงูุฏูููุฉ ุฅูู ${S.internationalLoans.trustIndex.toFixed(0)}%.`);
            }
            S.internationalLoans.activeRequests.splice(index, 1);
            S.bankMailCount = S.internationalLoans.activeRequests.length;
            uUI();
        };

        window.restoreInternationalTrust = () => {
            const cost = S.internationalLoans.trustPenaltyCost;
            if (S.m < cost) return;
            S.m -= cost;
            S.internationalLoans.trustIndex = 100;
            alert('โ ุชู ุฏูุน ุงูุบุฑุงูุฉ. ุงุณุชุนุงุฏ ูุคุดุฑ ุงูุซูุฉ ุงูุฏูููุฉ ูููุชู 100%.');
            uUI();
        };
        
        function generateInternationalLoanOffer() {
            if (S.internationalLoans.trustIndex < 100 && Math.random() < (100 - S.internationalLoans.trustIndex) / 100) {
                 // ุชูู ูุฑุตุฉ ุงููุฏูู ุฅุฐุง ูุงูุช ุงูุซูุฉ ููุฎูุถุฉ ุฌุฏุงู
                 return;
            }

            const country = COUNTRIES[Math.floor(Math.random() * COUNTRIES.length)];
            const baseAmount = Math.floor(Math.random() * 9 + 1) * 1e4; // 10k$ to 100k$
            const interestRate = Math.random() * 0.79 + 0.01; // 1% to 80%
            const duration = Math.floor(Math.random() * 9 + 1) * 60; // 1 to 10 minutes

            addBankMailMessage({
                country: country,
                amount: baseAmount,
                interestRate: interestRate,
                timer: duration,
                id: Date.now()
            });
        }
        
        function uActiveInternationalLoansUI() {
            const list = $('activeInternationalLoanList');
            const activeLoans = S.internationalLoans.myActiveLoans;
            list.innerHTML = '';

            if (activeLoans.length === 0) {
                list.insertAdjacentHTML('beforeend', `<p style="text-align:center;color:var(--muted);">ูุง ุชูุฌุฏ ูุฑูุถ ุฏูููุฉ ููุฏ ุงูุณุฏุงุฏ.</p>`);
                $('activeInternationalLoans').classList.add('hidden');
                return;
            }

            $('activeInternationalLoans').classList.remove('hidden');

            activeLoans.forEach((loan, index) => {
                const profit = loan.totalRepay - loan.amount;
                list.insertAdjacentHTML('beforeend', `
                    <div class="item-row">
                        <div style="flex-grow:1;">
                            <span style="font-weight:700;">${loan.country} (ุงุณุชุซูุงุฑ: ${formatNumber(loan.amount)}$)</span>
                            <p style="font-size:.8em;margin:0;color:var(--success);">ุฑุจุญ: ${formatNumber(profit)}$ | ุงูุนุงุฆุฏ ุงูููู: ${formatNumber(loan.totalRepay)}$</p>
                        </div>
                        <span style="color:var(--warn);">${formatTime(loan.timer)} ูุชุจูู</span>
                    </div>
                `);
            });
        }
        // --- ููุงูุฉ ูุธุงุฆู ุจุฑูุฏ ุงูุจูู ูุงููุฑูุถ ุงูุฏูููุฉ ุงูุฌุฏูุฏุฉ ---

        function getMachineStats(){
            const prodMachines=S.machines.filter(m=>!m.isPower&&m.count>0),powerStations=S.machines.filter(m=>m.isPower);
            const totalMachinesCount=prodMachines.reduce((sum,m)=>sum+m.count,0);
            let totalPowerOwned=powerStations.reduce((sum,p)=>sum+(p.failureTime<=0?p.powerPerMin:0),0);
            let machinesRunning=0,currentWorkers=S.w,currentPower=totalPowerOwned,machinesToRun=[];
            for(const machine of prodMachines)
                for(let i=0;i<machine.count;i++)
                    if(!S.isStrike&&S.breakTimer===0&&currentWorkers>=1&&currentPower>=machine.powerConsume){
                        machinesRunning++;currentWorkers--;currentPower-=machine.powerConsume;machinesToRun.push(machine);
                    }
            return {workersExtra:Math.max(0,S.w-totalMachinesCount),machinesRunning,machinesToRun,currentPowerRemaining:currentPower};
        }

        function uMachineList(){
            const list=$('machineList');list.innerHTML='';const productionMachines=MACHINES.filter(m=>!m.isPower);
            productionMachines.forEach(m=>{const owned=S.machines.find(sm=>sm.id===m.id&&!sm.isPower)?.count||0;list.insertAdjacentHTML('beforeend',`<div class="item-row"><span>${m.name} (+${formatNumber(m.pPerMin*1.1/60,0)}P/s) - (ูุณุชููู ${m.powerConsume}MW)</span><div class="h-input-group"><span style="font-weight:700;">ููููู: ${owned}</span><button onclick="buyItem(${m.id},!1)" ${S.m<m.cost?'disabled':''}>ุดุฑุงุก (${formatNumber(m.cost)}$)</button></div></div>`);});
        }

        function uPowerList(){
            const list=$('powerList');list.innerHTML='';const powerMachines=MACHINES.filter(m=>m.isPower);
            powerMachines.forEach(m=>{const ownedList=S.machines.filter(sm=>sm.id===m.id&&sm.isPower).length;list.insertAdjacentHTML('beforeend',`<div class="item-row"><span>${m.name} (${m.powerPerMin}MW)</span><div class="h-input-group"><span style="font-weight:700;">ููููู: ${ownedList}</span><button onclick="buyItem(${m.id},!0)" ${S.m<m.cost?'disabled':''}>ุดุฑุงุก (${formatNumber(m.cost)}$)</button></div></div>`);});
            if(S.machines.filter(m=>m.isPower).length>0)list.insertAdjacentHTML('beforeend',`<div style="margin-top:10px;font-size:.8em;color:var(--warn);">* ุงููููุฏุงุช ูุนุฑุถุฉ ููุนุทู ุจุดูู ุฏูุฑู.</div>`);
        }
        function uEstateList(){
             const list=$('estateList');list.innerHTML='';
             ESTATES.forEach(e=>{const ownedCount=S.eOwned.filter(owned=>owned[0]===e.id).length;const totalRent=ownedCount*e.rentPerMin;list.insertAdjacentHTML('beforeend',`<div class="item-row"><span>${e.name} (+${formatNumber(e.rentPerMin,0)}P/m)</span><div class="h-input-group"><span style="font-weight:700;">ููููู: ${ownedCount} (ุงููุฌููุน: ${formatNumber(totalRent,0)}P/m)</span><button onclick="buyEstate(${e.id})" ${S.m<e.price?'disabled':''}>ุดุฑุงุก (${formatNumber(e.price)}$)</button></div></div>`);});
        }
        function uCarList(){
            const list=$('carList');list.innerHTML='';
            CARS.forEach(c=>{if(!S.cOwned.some(owned=>owned[0]===c.id))list.insertAdjacentHTML('beforeend',`<div class="item-row"><span>${c.name} (ุนุฑุถ ููุจูุน ุจุนุฏ ุงูุดุฑุงุก)</span><button onclick="buyCar(${c.id})" ${S.m<c.price?'disabled':''}>ุดุฑุงุก (${formatNumber(c.price)}$)</button></div>`);});
            S.cOwned.forEach(car=>{
                const [id,name,price,rejectedCount,offersLeft,offerValue,nextOfferTime]=car;
                let statusHtml,buttonsHtml;
                if(offerValue>0){
                    const profit=offerValue-price;
                    statusHtml=`<span style="color:var(--danger);font-weight:700;">ุนุฑุถ: ${formatNumber(offerValue)}$ (${profit>0?'+'+formatNumber(profit)+'$ ุฑุจุญ':formatNumber(profit)+'$ ุฎุณุงุฑุฉ'})</span>`;
                    buttonsHtml=`<button class="action-btn" onclick="acceptOffer(${id})">ูุจูู</button><button class="danger-btn" onclick="rejectOffer(${id})">ุฑูุถ (${offersLeft-1} ูุฑุต)</button>`;
                }else if(offersLeft<=0){
                    statusHtml=`<span style="color:var(--danger);">ููุตุงุฏุฑุฉ ูุดููุฉ!</span>`;buttonsHtml=`<button disabled>ูุง ุชูุฌุฏ ุนุฑูุถ</button>`;
                }else{
                    // ุฅุฎูุงุก ููุช ุงูุนุฑุถ ุงููุชุจูู
                    statusHtml=`<span style="color:var(--warn);">ูู ุงูุชุธุงุฑ ุนุฑุถ...</span>`; 
                    buttonsHtml=`<button disabled>ุงูุชุธุงุฑ ุงูุนุฑุถ (${offersLeft} ูุฑุต)</button>`;
                }
                list.insertAdjacentHTML('beforeend',`<div class="item-row" style="background:${offerValue>0?'rgba(255,107,107,.1)':'transparent'};">
                    <div style="flex-grow:1;"><span style="font-weight:700;">${name} (ุดุฑุงุก: ${formatNumber(price)}$)</span><p style="font-size:.8em;margin:0;color:var(--muted);">ุฑูุถุช: ${rejectedCount} ูุฑุงุช</p></div>
                    <div class="h-input-group">${statusHtml}${buttonsHtml}</div></div>`);
            });
        }
        function uAchievementsList(){
            const list=$('achievementsList');list.innerHTML='';
            ACHIEVEMENTS.forEach(ach=>{const isAchieved=S.achievements[ach.id];list.insertAdjacentHTML('beforeend',`<div class="item-row" style="opacity:${isAchieved?.5:1};"><span style="font-weight:700;">${ach.name}</span><div class="h-input-group">
                <span style="color:var(--success);">ููุงูุฃุฉ: ${formatNumber(ach.reward)}$</span>
                <button ${isAchieved?'disabled':`onclick="checkAndClaimAchievement('${ach.id}')"`}>${isAchieved?'ููุชูู โ':'ุชุญูู ูุงุณุชูู'}</button></div></div>`);});
        }
        function checkAchievements(){
            ACHIEVEMENTS.forEach(ach=>{
                if(!S.achievements[ach.id]&&ach.check()){
                    S.achievements[ach.id]=!0;S.m+=ach.reward;
                }
            });
        }
        function uFarmList(){
            const list=$('farmList');list.innerHTML='';
            if(S.farm.length===0){list.insertAdjacentHTML('beforeend',`<p style="text-align:center;color:var(--muted);">ูุง ุชูุฌุฏ ูุญุงุตูู ูุฒุฑูุนุฉ ุญุงููุงู.</p>`);return;}
            S.farm.forEach((crop,index)=>{
                const totalExpectedReturn=crop.investment*(1+FARM_PROFIT_RATE);
                const status=crop.ready?`<span style="color:var(--success);font-weight:700;">ุฌุงูุฒ ููุญุตุงุฏ!</span>`:`<span style="color:var(--warn);">ูููู...</span>`; 
                const button=crop.ready?`<button class="action-btn" onclick="harvest(${index})">ุญุตุงุฏ (${formatNumber(totalExpectedReturn,2)}$)</button>`:`<button disabled>ูููู...</button>`;
                list.insertAdjacentHTML('beforeend',`<div class="item-row"><div><span style="font-weight:700;">ูุญุตูู ${index+1} (${formatNumber(crop.seeds,0)} ุจุฐุฑุฉ)</span><p style="font-size:.8em;margin:0;color:var(--muted);">ุงูุงุณุชุซูุงุฑ ุงูุฃุตูู: ${formatNumber(crop.investment,0)}$</p></div><div style="display:flex;align-items:center;gap:10px;">${status}${button}</div></div>`);
            });
        }

        // -----------------------------------------------------------
        // ๐ ูุธููุฉ ุนุฑุถ ุงููุงุฌูุฉ ุงูุฌุฏูุฏุฉ (Black Market UI)
        // -----------------------------------------------------------
        window.getCurrentExportPrice = () => {
            const market = S.blackMarket;
            let price = market.baseExportPrice * (1 + (market.tensionIndex * 0.5 - 0.25)); 
            
            if (market.isFlawedBlueprint) {
                price *= 0.5; 
            }
            return Math.max(1000, price); 
        };

        window.uBlackMarketUI = () => {
            const market = S.blackMarket;
            if (!market) return; 
            
            const currentPrice = getCurrentExportPrice();

            if ($('bm_tension')) $('bm_tension').textContent = market.tensionIndex.toFixed(2);
            if ($('bm_exposure')) $('bm_exposure').textContent = `${market.exposure.toFixed(1)}%`;
            if ($('bm_price')) $('bm_price').textContent = formatNumber(currentPrice) + '$';
            if ($('bm_units')) $('bm_units').textContent = formatNumber(market.weaponUnits, 0);
            
            // ุญุงูุฉ ุงููุฎุทุทุงุช
            if ($('bm_blueprint_status')) {
                let status = 'โ ูุง ููุฌุฏ';
                if (market.hasBlueprints) {
                    status = market.isFlawedBlueprint ? 'โ๏ธ ูุงุดู (ูุตู ุงูุณุนุฑ)' : 'โ ุฌุงูุฒ';
                }
                $('bm_blueprint_status').textContent = status;
                $('buyBlueprintsBtn').disabled = market.hasBlueprints || S.bank.balance < market.blueprintCost;
            }
            
            // ุญุงูุฉ ุงูุชุฑุฎูุต
            if ($('bm_license_status')) {
                $('bm_license_status').textContent = market.exportLicense ? 'โ ูุดุท' : 'โ ูุง ููุฌุฏ';
                $('buyLicenseBtn').disabled = market.exportLicense || S.bank.balance < market.licenseCost;
            }

            // ุญุงูุฉ ุขูุงุช ุงูุชุฌููุน
            if ($('bm_lines_count')) {
                $('bm_lines_count').textContent = market.assemblyLines;
                $('buyAssemblyLineBtn').disabled = !market.hasBlueprints || S.bank.balance < market.assemblyCost;
            }
            
            // ุญุงูุฉ ุงูุฅูุชุงุฌ
            if ($('startWeaponProductionBtn')) {
                const amountToProduce = market.assemblyLines;
                const pCost = market.pCostPerUnit * amountToProduce;
                $('startWeaponProductionBtn').disabled = market.assemblyLines === 0 || S.p < pCost || !market.hasBlueprints;
            }
            // ุญุงูุฉ ุงูุชุตุฏูุฑ
            if ($('exportWeaponsBtn')) {
                const totalRevenue = market.weaponUnits * currentPrice;
                $('exportWeaponsBtn').textContent = `ุชุตุฏูุฑ ${market.weaponUnits} ูุญุฏุฉ (ุฑุจุญ ูููุฏุฑ: ${formatNumber(totalRevenue)}$)`;
                $('exportWeaponsBtn').disabled = market.weaponUnits === 0 || !market.exportLicense;
            }

            if(S.currentView === 'view-black-market') {
                $('view-black-market').style.background = '#020617'; 
            } else {
                $('view-black-market').style.background = 'var(--card)';
            }
        };

        // -----------------------------------------------------------
        // ๐ ูุธุงุฆู ุฅุฏุงุฑุฉ ุงูุณูู ุงูุณูุฏุงุก
        // -----------------------------------------------------------
        window.buyBlueprints = () => {
            const market = S.blackMarket;
            if (market.hasBlueprints || S.bank.balance < market.blueprintCost) return;
            
            S.bank.balance -= market.blueprintCost;
            market.hasBlueprints = true;
            
            if (Math.random() < 0.10) { 
                market.isFlawedBlueprint = true;
                alert(`โ๏ธ ุดุฑุงุก ุงููุฎุทุทุงุช ูุดู! ุชู ุงูุชุดุงู ุฎุทุฃ (Flawed Blueprint). ุณุนุฑ ุงูุจูุน ุงูุฏุงุฆู -50%.`);
            } else {
                alert(`โ ุชู ุดุฑุงุก ุงููุฎุทุทุงุช ุงูุณุฑูุฉ ุจูุฌุงุญ! ุงุจุฏุฃ ุจุดุฑุงุก ุฎุทูุท ุงูุชุฌููุน.`);
            }
            uUI();
        };

        window.buyAssemblyLine = () => {
            const market = S.blackMarket;
            if (!market.hasBlueprints || S.bank.balance < market.assemblyCost) return;
            
            S.bank.balance -= market.assemblyCost;
            market.assemblyLines += 1;
            alert(`โ ุชู ุดุฑุงุก ุฎุท ุชุฌููุน ุฌุฏูุฏ. ุนุฏุฏ ุฎุทูุท ุงูุชุฌููุน: ${market.assemblyLines}.`);
            uUI();
        };

        window.buyExportLicense = () => {
            const market = S.blackMarket;
            if (market.exportLicense || S.bank.balance < market.licenseCost) return;
            
            S.bank.balance -= market.licenseCost;
            market.exportLicense = true;
            alert(`โ ุชู ุดุฑุงุก ุชุฑุฎูุต ุงูุชุตุฏูุฑ. ุงูุขู ููููู ุงูุจูุน!`);
            uUI();
        };

        window.startWeaponProduction = () => {
            const market = S.blackMarket;
            const amountToProduce = market.assemblyLines;
            const pCost = market.pCostPerUnit * amountToProduce;

            if (!market.hasBlueprints) { alert('ูุฌุจ ุดุฑุงุก ุงููุฎุทุทุงุช ุฃููุงู!'); return; }
            if (amountToProduce === 0) { alert('ูุฌุจ ุดุฑุงุก ุขูุงุช ุงูุชุฌููุน ุฃููุงู!'); return; }
            if (S.p < pCost) { alert(`ููุงุทู (P) ุบูุฑ ูุงููุฉ! ุชุญุชุงุฌ ${formatNumber(pCost, 0)}P ูุฅูุชุงุฌ ${amountToProduce} ูุญุฏุฉ.`); return; }
            
            S.p -= pCost;
            market.weaponUnits += amountToProduce;
            alert(`โ ุชู ุชุตููุน ${amountToProduce} ูุญุฏุฉ ุณูุงุญ ุจุงุณุชุฎุฏุงู ${formatNumber(pCost, 0)}P. ุฃุตุจุญุช ุฌุงูุฒุฉ ููุชุตุฏูุฑ.`);
            uUI();
        };

        window.exportWeapons = () => {
            const market = S.blackMarket;
            if (market.weaponUnits === 0 || !market.exportLicense) return;

            const units = market.weaponUnits;
            const price = getCurrentExportPrice();
            const revenue = units * price;
            
            market.exposure += units * 5; 
            
            S.bank.balance += revenue;
            market.weaponUnits = 0;
            
            addMailMessage('ุงูุชุตุงุฏ ููู', `๐ฅ ุชู ุชุตุฏูุฑ ${units} ูุญุฏุฉ ุณูุงุญ ููุงุจู ${formatNumber(revenue)}$ ุฅูู ุงูุจูู ุงููุฑูุฒู.`);
            alert(`๐ฅ ุตููุฉ ุชุตุฏูุฑ ูุงุฌุญุฉ! ุฅุฌูุงูู ุงูุฑุจุญ: ${formatNumber(revenue)}$ุ ุฒุงุฏ ุงูุชุนุฑุถ ููุฎุทุฑ ุฅูู ${market.exposure.toFixed(1)}%.`);
            uUI();
        };

        // -----------------------------------------------------------
        // ๐ ูุธููุฉ ุงูุชุญุฏูุซุงุช ุงูุฏูุฑูุฉ ููุณูู ุงูุณูุฏุงุก
        // -----------------------------------------------------------
        window.updateBlackMarketStatus = () => {
            const market = S.blackMarket;
            
            // 1. ุชููุจ ูุคุดุฑ ุงูุชูุชุฑ ุงูุนุงููู (ูู ุฏูููุฉ)
            const volatility = 0.15; 
            market.tensionIndex = Math.min(1.0, Math.max(0.1, market.tensionIndex + (Math.random() * volatility * 2 - volatility)));

            // 2. ุงูุชุญูู ูู ุงูุชุนุฑุถ ููุฎุทุฑ (ุงููุตุงุฏุฑุฉ)
            if (market.exposure >= 100) {
                const confiscatedAmount = S.bank.balance * 0.50;
                S.bank.balance -= confiscatedAmount;
                market.exposure = 0;
                addMailMessage('ูุตุงุฏุฑุฉ ุณูุงุฑุฉ', `๐จ ุชู ุงููุดู ุนู ุฃูุดุทุชู! ูุตุงุฏุฑุฉ 50% ูู ุฑุตูุฏ ุงูุจูู ุงููุฑูุฒู: ${formatNumber(confiscatedAmount)}$.`);
                alert(`๐จ ูุงุฑุซุฉ! ุชู ุงููุดู ุนู ุฃูุดุทุชู ุงูุณุฑูุฉ ููุตุงุฏุฑุฉ 50% ูู ุฑุตูุฏู ูู ุงูุจูู ุงููุฑูุฒู!`);
            }
        };

        
        function uUI(){
            const stats=getMachineStats();const isBigLoanActive=S.bigLoan.active;const isSmallLoanActive=S.debt>0;
            const totalDebt=S.debt+(isBigLoanActive?S.bigLoan.totalRepay:0);const isBreaking=S.breakTimer>0;const isStrike=S.isStrike;
            const isPenaltyTime=!S.bigLoan.active&&S.bigLoan.initial>0&&S.bigLoan.totalRepay>0&&S.bigLoan.timer<=0;
            const currentPToM=S.flashSale.active?FLASH_SALE_P_TO_M:BASE_P_TO_M;const currentConversionRate=100/currentPToM;
            
            $('h_money').textContent=formatNumber(S.m,S.m<1e3?2:1)+'$';$('h_bank').textContent=formatNumber(S.bank.balance,S.bank.balance<1e3?2:1)+'$';$('h_points').textContent=formatNumber(S.p,0)+'P';

            if($('debt'))$('debt').textContent=formatNumber(totalDebt,totalDebt<1e3?2:1);
            if($('power'))$('power').textContent=stats.currentPowerRemaining.toFixed(0); 
            if($('workers_extra'))$('workers_extra').textContent=stats.workersExtra;
            if($('machines_running'))$('machines_running').textContent=stats.machinesRunning;
            if($('factoryLvl'))$('factoryLvl').textContent=S.factoryLvl;
            if($('upgradeFactoryBtn')){$('upgradeFactoryBtn').textContent=`ุชุฑููุฉ (${formatNumber(S.upgradeCost,S.upgradeCost<1e3?2:1)} ุฑุตูุฏ)`;$('upgradeFactoryBtn').disabled=S.m<S.upgradeCost;}
            if($('bankP'))$('bankP').textContent=formatNumber(S.bankP,0);
            
            if($('convertBtn')){$('convertBtn').textContent=`ุชุญููู ุงูููุงุท (100P = ${formatNumber(currentConversionRate,2)}$ ${S.flashSale.active?'๐ฅ':''})`;$('convertBtn').classList.toggle('warn-btn',!S.flashSale.active);$('convertBtn').classList.toggle('danger-btn',S.flashSale.active);}
            if($('moralePercent'))$('moralePercent').textContent=`${S.morale.toFixed(0)}%`;
            const moraleBar=$('moraleBar');
            if(moraleBar){
                moraleBar.style.width=`${S.morale}%`;
                moraleBar.style.background=S.morale>75?'var(--success)':S.morale>25?'var(--warn)':'var(--danger)';
            }

            const statusMsg=$('statusMsg');
            if(statusMsg){
                if(isStrike){statusMsg.textContent=`๐ด ุฅุถุฑุงุจ ุงูุนูุงู! ุชููู ุงูุฅูุชุงุฌ ุชูุงูุงู. ุงุฏูุน ููุทุนุงู ูุฅููุงุฆู.`;}
                else if(S.flashSale.active){statusMsg.textContent=`๐ฅ ุตุนูุฏ ุฃุณุนุงุฑ ุฌูููู! ${formatNumber(currentConversionRate,2)}$ ููู 100P. ูุชุจูู: ${S.flashSale.timer} ุซูุงูู!`;statusMsg.style.color='var(--danger)';}
                else if(isBreaking){statusMsg.textContent=`ุงุณุชุฑุงุญุฉ ุงูุนูุงู! ุชููู ุงูุฅูุชุงุฌ ูุคูุชุงู (${S.breakTimer} ุซุงููุฉ ูุชุจููุฉ).`;}
                else{statusMsg.textContent='ุงููุนูู ูุนูู ุจูุงูู ุทุงูุชู.';statusMsg.style.color='var(--warn)';}
            }

            const failedGenerators=S.machines.filter(m=>m.isPower&&m.failureTime>0).length;const powerFailureStatus=$('powerFailureStatus');
            if(powerFailureStatus){
                if(failedGenerators>0){powerFailureStatus.textContent=`ููุฌุฏ ${failedGenerators} ูููุฏ ูุนุทู (${S.machines.find(m=>m.failureTime>0)?.failureTime||0}s)!`;powerFailureStatus.style.color='var(--danger)';}
                else{powerFailureStatus.textContent='ูุง ุชูุฌุฏ ุฃุนุทุงู';powerFailureStatus.style.color='var(--success)';}
            }
            
            const mailIcon = $('mailIcon');
            if(mailIcon) mailIcon.classList.toggle('unread', S.offersCount > 0);
            if($('mailCount')){$('mailCount').textContent=S.offersCount;$('mailCount').classList.toggle('hidden',S.offersCount===0);}
            
            // ๐ ุฃููููุฉ ุจุฑูุฏ ุงูุจูู
            const bankMailIcon = $('bankMailIcon');
            if(bankMailIcon) bankMailIcon.classList.toggle('unread', S.internationalLoans.activeRequests.length > 0);
            if($('bankMailCount')){$('bankMailCount').textContent=S.internationalLoans.activeRequests.length;$('bankMailCount').classList.toggle('hidden',S.internationalLoans.activeRequests.length===0);}
            
            if($('bigLoanForm'))$('bigLoanForm').classList.toggle('hidden',isBigLoanActive||isPenaltyTime);
            if($('bigLoanStatus'))$('bigLoanStatus').classList.toggle('hidden',!isBigLoanActive); 
            if($('loanConsequence'))$('loanConsequence').classList.toggle('hidden',!isPenaltyTime);
            
            if(isBigLoanActive&&$('currentLoanAmount')){
                const minPayment=S.bigLoan.totalRepay*.10;
                $('currentLoanAmount').textContent=formatNumber(S.bigLoan.amount,S.bigLoan.amount<1e3?2:1);
                $('totalRepayAmount').textContent=formatNumber(S.bigLoan.totalRepay,S.bigLoan.totalRepay<1e3?2:1);
                $('currentInterestRate').textContent=(S.bigLoan.interest*100).toFixed(0);
                $('bigLoanTimer').textContent=formatTime(S.bigLoan.timer);
                $('minPaymentAmount').textContent=formatNumber(minPayment,minPayment<1e3?2:1);
                $('repayAmount').min=minPayment.toFixed(2);
                $('repayAmount').value=Math.min(S.bigLoan.totalRepay,Math.max(minPayment,parseFloat($('repayAmount').value)||0)).toFixed(2);
            }
            
            if($('loan500Btn'))$('loan500Btn').disabled=isSmallLoanActive||isBigLoanActive||isPenaltyTime;
            if($('loan250Btn'))$('loan250Btn').disabled=isSmallLoanActive||isBigLoanActive||isPenaltyTime;
            if($('smallLoanStatus'))$('smallLoanStatus').classList.toggle('hidden',!isSmallLoanActive);
            if(isSmallLoanActive&&$('currentSmallDebt'))$('currentSmallDebt').textContent=formatNumber(S.debt,S.debt<1e3?2:1);

            if($('buyWorkerBtn'))$('buyWorkerBtn').disabled=S.m<W_COST;
            if($('feedWorkerBtn'))$('feedWorkerBtn').disabled=S.m<FOOD_COST||S.w===0;
            if($('convertBtn'))$('convertBtn').disabled=S.p<100;
            
            uBlackMarketUI(); 

            if(S.currentView==='view-game'){uMachineList();uPowerList();uMailList();} 
            else if(S.currentView==='view-estate'){uEstateList();}
            else if(S.currentView==='view-car'){uCarList();}
            else if(S.currentView==='view-achievements'){uAchievementsList();}
            else if(S.currentView==='view-bank'){
                if($('bankBalance'))$('bankBalance').textContent=formatNumber(S.bank.balance,S.bank.balance<1e3?2:1);
                if($('depositAmount'))$('depositAmount').max=S.m.toFixed(2);
                if($('withdrawAmount'))$('withdrawAmount').max=S.bank.balance.toFixed(2);
                if($('carProfitDisplay'))$('carProfitDisplay').textContent=formatNumber(S.carProfit,S.carProfit<1e3?2:1)+'$';
                if($('carProfit'))$('carProfit').textContent=formatNumber(S.carProfit,S.carProfit<1e3?2:1);
                uBankMailUI(); // ุชุญุฏูุซ ูุงุฌูุฉ ุจุฑูุฏ ุงูุจูู
                uActiveInternationalLoansUI();
            }
            else if(S.currentView==='view-farm'){uFarmList();}
            else if (S.currentView === 'view-phones') {
                if ($('phone_parts')) $('phone_parts').textContent = formatNumber(S.phones.parts, 0);
                if ($('phone_batteries')) $('phone_batteries').textContent = formatNumber(S.phones.batteries, 0);
                if ($('phone_stock')) $('phone_stock').textContent = formatNumber(S.phones.stock, 0);
                if ($('phone_machine_count')) $('phone_machine_count').textContent = formatNumber(S.phones.machine.count, 0);
                if ($('phoneMachineCostDisplay')) $('phoneMachineCostDisplay').textContent = formatNumber(S.phones.machine.cost);

                 if ($('phone_storage_capacity')) $('phone_storage_capacity').textContent = formatNumber(S.phones.storageCapacity, 0);
                if ($('buyStorageBtn')) {
                    $('buyStorageBtn').textContent = `ุดุฑุงุก ูุณุงุญุฉ ูุงุชู ูุงุญุฏ (${formatNumber(S.phones.storageCost)}$)`;
                    $('buyStorageBtn').disabled = S.m < S.phones.storageCost;
                }

                if ($('buyPhoneMachineBtn')) {
                    $('buyPhoneMachineBtn').textContent = `ุดุฑุงุก ุขูุฉ (${formatNumber(S.phones.machine.cost)}$)`;
                    $('buyPhoneMachineBtn').disabled = S.m < S.phones.machine.cost;
                }
                const shipmentStatus = $('shipmentStatus');
                if (S.shipments.length > 0) {
                    shipmentStatus.style.color = 'var(--warn)';
                    shipmentStatus.innerHTML = S.shipments.map(s => 
                        `โ๏ธ ุดุญูุฉ ${s.count} ุชุฌููุนุฉ ููููุงุช ูุงุฏูุฉ.`).join('<br>'); 
                } else {
                    shipmentStatus.innerHTML = 'ูุง ุชูุฌุฏ ุดุญูุงุช ูุงุฏูุฉ ุญุงููุงู.';
                    shipmentStatus.style.color = 'var(--muted)';
                }
                const prodList = $('productionList');
                prodList.innerHTML = S.phones.production.length > 0
                    ? S.phones.production.map((p, i) => 
                        `<div class="item-row"><span>ูุงุชู ููุฏ ุงูุชุตููุน #${i + 1}</span><span>ูุชุจูู: ${formatTime(p.timer)}</span></div>`).join('')
                    : `<p style="text-align:center;color:var(--muted);">ูุง ููุฌุฏ ุดูุก ููุฏ ุงูุชุตููุน.</p>`;
                
                if ($('startProductionBtn')) {
                    const currentTotalStorage = S.phones.stock + S.phones.production.length;
                    const capacityRemaining = S.phones.storageCapacity - currentTotalStorage;
                    const availableToProduce = Math.min(S.phones.parts, S.phones.batteries, S.phones.machine.count);
                    const canStart = Math.min(availableToProduce, capacityRemaining);
                    
                    $('startProductionBtn').disabled = canStart <= 0;
                    $('startProductionBtn').textContent = `ุจุฏุก ุชุตููุน (${canStart} ูุงุชู)`;
                }

                const orderStatus = $('orderStatus');
                if (S.phones.currentOrder) {
                    const order = S.phones.currentOrder;
                    orderStatus.innerHTML = `
                        <h4 style="color:var(--info);margin-top:0;">
                            ููุน ุงูุทูุจ: ${order.type}
                        </h4>
                        <p>ุงููููุฉ ุงููุทููุจุฉ: <span style="font-weight:700;">${order.required} ูุงุชู</span></p>
                        <p>ุณุนุฑ ุงูุจูุน: <span style="font-weight:700;color:var(--success);">${formatNumber(order.price)}$ / ูุงุชู</span></p>
                        <p style="display:none;">ุงูููุช ุงููุชุจูู ููุชูููุฐ: <span style="font-weight:700;">--</span></p>
                    `;
                    $('sellPhonesBtn').disabled = S.phones.stock < order.required || order.timer <= 0;
                    $('sellPhonesBtn').textContent = `ุจูุน ${order.required} ูุงุชู`;
                } else {
                    orderStatus.innerHTML = `<p style="text-align:center;color:var(--muted);">ูุง ููุฌุฏ ุทูุจ ูุดุท ุญุงููุงู. ููุชุธุฑ ุทูุจ ุฌุฏูุฏ.</p>`; 
                    $('sellPhonesBtn').disabled = true;
                }
            }
        }
        
        function plantSeeds(count){
            if(isNaN(count)||count<=0){alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนุฏุฏ ุตุญูุญ ูููุฌุจ ููุจุฐูุฑ.');return;}
            const totalCost=count*SEED_COST;
            if(S.m<totalCost){alert('ุงูุฑุตูุฏ ุงููุญูู ุบูุฑ ูุงูู ูุดุฑุงุก ุงูุจุฐูุฑ.');return;}
            S.m-=totalCost;
            const growthTime=Math.floor(Math.random()*(FARM_GROWTH_MAX-FARM_GROWTH_MIN+1))+FARM_GROWTH_MIN;
            S.farm.push({seeds:count,investment:totalCost,timer:growthTime,ready:!1});
            uUI();
        }

        function harvest(index){
            const crop=S.farm[index];if(!crop||!crop.ready)return;
            const totalReturn=crop.investment*(1+FARM_PROFIT_RATE);
            S.bank.balance+=totalReturn;S.farm.splice(index,1);
            alert(`๐ ุญุตุงุฏ ูุงุฌุญ! ุฅุฌูุงูู ุงูุนุงุฆุฏ: ${formatNumber(totalReturn,2)}$ ุชู ุชุญูููู ุฅูู ุงูุจูู ุงููุฑูุฒู.`);
            uUI();
        }

        // ๐ ูุธููุฉ ุญุตุฏ ุงููู
        window.harvestAllReady = () => {
            let totalRevenue = 0;
            // ุฌูุน ุงูุนุงุฆุฏุงุช
            const cropsToHarvest = S.farm.filter(crop => crop.ready);
            if (cropsToHarvest.length === 0) {
                alert('ูุง ุชูุฌุฏ ูุญุงุตูู ุฌุงูุฒุฉ ููุญุตุงุฏ ุญุงููุงู.');
                return;
            }

            cropsToHarvest.forEach(crop => {
                totalRevenue += crop.investment * (1 + FARM_PROFIT_RATE);
            });

            // ุชุญุฏูุซ ุงูุญุงูุฉ
            S.bank.balance += totalRevenue;
            S.farm = S.farm.filter(crop => !crop.ready);
            
            alert(`๐ ุชู ุญุตุงุฏ ${cropsToHarvest.length} ูุญุตููุงู ุฌุงูุฒุงู. ุฅุฌูุงูู ุงูุนุงุฆุฏ: ${formatNumber(totalRevenue, 2)}$ ุชู ุชุญูููู ุฅูู ุงูุจูู ุงููุฑูุฒู.`);
            uUI();
        };
        
        function transferMoney(type,all=!1){
            let amount=0;const input=$(`${type}Amount`);
            if(type==='deposit'){
                amount=all?S.m:parseFloat(input.value);
                if(isNaN(amount)||amount<=0){alert('ูุฌุจ ุฅุฏุฎุงู ูุจูุบ ุตุญูุญ.');return;}
                amount=Math.min(amount,S.m);if(amount<=0){alert('ููุณ ูุฏูู ุฑุตูุฏ ูุญูู ูุงูู ููุฅูุฏุงุน.');return;}
                S.m-=amount;S.bank.balance+=amount;alert(`โ ุชู ุฅูุฏุงุน ${formatNumber(amount,2)}$ ูู ุงูุจูู ุงููุฑูุฒู ุจูุฌุงุญ.`);input.value='100';
            }else if(type==='withdraw'){
                amount=all?S.bank.balance:parseFloat(input.value);
                if(isNaN(amount)||amount<=0){alert('ูุฌุจ ุฅุฏุฎุงู ูุจูุบ ุตุญูุญ.');return;}
                amount=Math.min(amount,S.bank.balance);if(amount<=0){alert('ููุณ ูุฏูู ุฑุตูุฏ ูุงูู ูู ุงูุจูู ุงููุฑูุฒู ููุณุญุจ.');return;}
                const fee=amount*BANK_WITHDRAWAL_FEE;const netAmount=amount-fee;
                S.bank.balance-=amount;S.m+=netAmount;
                alert(`โ ุชู ุณุญุจ ${formatNumber(amount,2)}$ุ ูุงูุชุทุน ${formatNumber(fee,2)}$ ุฑุณูู. ุตุงูู ุงููุจูุบ: ${formatNumber(netAmount,2)}$.`);input.value='100';
            }
            uUI();
        }

        window.takeSmallLoan=(amount,interest)=>{if(S.debt>0||S.bigLoan.active)return;S.debt=amount;S.loanA=interest;S.m+=amount;uUI();};
        window.repaySmallLoan=()=>{if(S.debt===0)return;if(S.m<S.debt){alert('ููุณ ูุฏูู ุฑุตูุฏ ูุงูู ูุณุฏุงุฏ ุงูุฏูู ุงูุญุงูู.');return;}S.m-=S.debt;S.debt=0;S.loanA=0;uUI();};
        
        // ๐ ุชุญุฏูุซ ุงููุฑุถ ุงููุจูุฑ (2M ููุงุฆุฏุฉ 100%)
        window.takeBigLoan=()=>{ 
            if(S.debt>0||S.bigLoan.active)return;
            const amount=parseFloat($('bigLoanAmount').value);const extraMinutes=parseInt($('extraTime').value);
            // ๐ ุชุญุฏูุซ ุงูุญุฏ ุงูุฃูุตู ูููุจูุบ
            if(amount<1e4||amount>2e6||isNaN(amount)||extraMinutes<0||isNaN(extraMinutes))return;
            // ๐ ุชุนุฏูู ุงููุงุฆุฏุฉ ุงูุฃุณุงุณูุฉ ุฅูู 1.0 (100%)
            let totalInterestRate=1.00+extraMinutes*.01;
            const totalRepay=amount*(1+totalInterestRate);const initialTimer=600+extraMinutes*60;
            S.bigLoan={initial:amount,amount:amount,interest:totalInterestRate,totalRepay:totalRepay,initialTotalRepay:totalRepay,timer:initialTimer,initialTimer:initialTimer,active:!0};
            S.m+=amount;uUI();
        };
        window.repayBigLoan=percentage=>{ 
            if(!S.bigLoan.active||S.bigLoan.totalRepay<=0)return;const minPayment=S.bigLoan.totalRepay*.10;
            let amountToRepay=percentage===.10?minPayment:parseFloat($('repayAmount').value);
            if(amountToRepay<minPayment){alert('ุงูุญุฏ ุงูุฃุฏูู ููุณุฏุงุฏ ูู 10% ูู ุงููุจูุบ ุงูููู ุงููุชุจูู.');return;}
            if(S.m<amountToRepay){alert('ููุณ ูุฏูู ุฑุตูุฏ ูุงูู!');return;}
            if(amountToRepay>S.bigLoan.totalRepay){amountToRepay=S.bigLoan.totalRepay;}
            S.m-=amountToRepay;S.bigLoan.totalRepay-=amountToRepay;
            S.bigLoan.amount-=S.bigLoan.initial*(amountToRepay/S.bigLoan.initialTotalRepay); 
            if(amountToRepay>0)S.bigLoan.timer=S.bigLoan.initialTimer; 
            if(S.bigLoan.totalRepay<=.01){S.m+=Math.abs(S.bigLoan.totalRepay);S.bigLoan={amount:0,initial:0,totalRepay:0,timer:0,interest:0,active:!1,initialTotalRepay:0,initialTimer:0};alert('โ ุชู ุณุฏุงุฏ ุงููุฑุถ ุงููุจูุฑ ุจูุฌุงุญ!');}
            uUI();
        };
        window.applyPenalty=option=>{ 
            if(S.bigLoan.initial===0||S.bigLoan.totalRepay<=0)return; 
            if(option===1){
                const penaltyCost=1e4;
                if(S.m<penaltyCost){applyPenalty(2);return;}
                S.m-=penaltyCost;S.bigLoan.interest+=.10;S.bigLoan.totalRepay=S.bigLoan.initial*(1+S.bigLoan.interest);
                S.bigLoan.initialTotalRepay=S.bigLoan.totalRepay;S.bigLoan.timer=S.bigLoan.initialTimer;S.bigLoan.active=!0;
                alert(`โ๏ธ ุชู ุฏูุน ุงูุบุฑุงูุฉ ${formatNumber(penaltyCost,0)}$ ูุฒูุงุฏุฉ ุงููุงุฆุฏุฉ. ูุฏูู ูุฑุตุฉ ุฃุฎุฑู.`);
            }else if(option===2){
                S.m=0;S.p=0;S.w=0;S.bankP=0;S.power=0;S.debt=0;S.cOwned=[];S.eOwned=[];S.machines=[];S.farm=[];S.phones.parts=0;S.phones.batteries=0;S.phones.stock=0;S.phones.production=[];S.shipments=[];
                S.bigLoan={amount:0,initial:0,totalRepay:0,timer:0,interest:0,active:!1,initialTotalRepay:0,initialTimer:0};
                alert('๐จ ูุตุงุฏุฑุฉ ุชุงูุฉ! ุชู ุณุญุจ ุฌููุน ุงูููุชููุงุช ูุงูุฃููุงู ุงููุญููุฉ. ุฃููุงูู ูู ุงูุจูู ุงููุฑูุฒู ุขููุฉ.');
            }
            uUI();
        };

        // --- ูุธุงุฆู ุณูู ุงูููุงุชู ---
        window.buyPhoneMachine=()=>{
            const cost=S.phones.machine.cost;
            if(S.m<cost){alert('ุงูุฑุตูุฏ ุงููุญูู ุบูุฑ ูุงูู ูุดุฑุงุก ุขูุฉ ุชุตููุน.');return;}
            S.m-=cost;
            S.phones.machine.count++;
            S.phones.machine.cost*=1.2; 
            uUI();
        };

        window.buyPhoneStorage=()=>{
            const cost=S.phones.storageCost;
            if(S.m<cost){alert('ุงูุฑุตูุฏ ุงููุญูู ุบูุฑ ูุงูู ูุดุฑุงุก ูุณุงุญุฉ ุชุฎุฒูู.');return;}
            S.m-=cost;
            S.phones.storageCapacity++;
            uUI();
        };

        window.orderComponents=()=>{
            const count=parseInt($('componentAmount').value);
            if(isNaN(count)||count<=0){alert('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุนุฏุฏ ุตุญูุญ ูููุฌุจ.');return;}
            const totalCost=count*S.phones.cost;
            if(S.m<totalCost){alert('ุงูุฑุตูุฏ ุงููุญูู ุบูุฑ ูุงูู ูุทูุจ ูุฐู ุงูููููุงุช.');return;}
            
            S.m-=totalCost;
            const arrivalTime=Math.floor(Math.random()*(120-30+1))+30; 
            S.shipments.push({type:'phoneComponents', count:count, timer:arrivalTime, cost:totalCost});
            addMailMessage('ุดุญูุฉ ูุงุชู (ูุตูู)', `ุชู ุฅุฑุณุงู ุทูุจ ุดุญูุฉ ${count} ุชุฌููุนุฉ ููููุงุช. ูุงุฏูุฉ ุฎูุงู ${formatTime(arrivalTime)} ุชูุฑูุจุงู.`);
            uUI();
        };

        window.startPhoneProduction=()=>{
            const currentTotalStorage = S.phones.stock + S.phones.production.length;
            const capacityRemaining = S.phones.storageCapacity - currentTotalStorage;
            const availableToProduce=Math.min(S.phones.parts, S.phones.batteries);
            const machinesAvailable=S.phones.machine.count;

            const canStart=Math.min(availableToProduce, machinesAvailable, capacityRemaining);
            
            if(canStart<=0){
                alert(`ูุง ูููู ุจุฏุก ุงูุชุตููุน. ุชุญูู ูู ุงูููููุงุช ุงููุชุงุญุฉ (${availableToProduce})ุ ุฃู ุงูุขูุงุช (${machinesAvailable})ุ ุฃู ุณุนุฉ ุงูุชุฎุฒูู ุงููุชุจููุฉ (${capacityRemaining}).`);
                return;
            }
            
            S.phones.parts-=canStart;
            S.phones.batteries-=canStart;
            
            for(let i=0;i<canStart;i++){
                S.phones.production.push({timer:30}); 
            }
            
            uUI();
        };

        function generateNewOrder(){
            const minProfitRate = 0.10;
            const maxProfitRate = 0.66;
            const baseCost = S.phones.cost; 

            const profitRate = minProfitRate + Math.random() * (maxProfitRate - minProfitRate);
            const price = Math.round(baseCost * (1 + profitRate)); 

            let type, required;
            const roll = Math.random();

            if (roll < 0.50) { 
                type = 'ุฒุจูู ุนุงุฏู';
                required = 1;
            } else if (roll < 0.85) { 
                type = 'ุชุงุฌุฑ ุฌููุฉ';
                required = 3;
            } else { 
                type = 'ุดุฑูุฉ ุนุงูููุฉ';
                required = 6;
            }
            
            S.phones.currentOrder={
                required: required, 
                price: price,
                timer: 15*60, 
                type: type, 
                id: Date.now()
            };
            
            addMailMessage('ุทูุจ ูุงุชู (ุฌุฏูุฏ)', `ูุตู ุทูุจ ุดุฑุงุก ุฌุฏูุฏ ูู ููุน ${type} ุจูููุฉ ${required}.`);
        }

        window.sellPhones=()=>{
            if(!S.phones.currentOrder||S.phones.stock===0||S.phones.currentOrder.timer<=0)return;

            const order=S.phones.currentOrder;
            
            if(S.phones.stock < order.required){
                 alert(`โ ูุง ููุฌุฏ ูุฎุฒูู ูุงูู! ุงููููุฉ ุงููุทููุจุฉ: ${order.required}ุ ุงููุฎุฒูู: ${S.phones.stock}.`);
                 return;
            }

            const soldCount=order.required;
            const revenue=soldCount*order.price;
            
            S.phones.stock-=soldCount;
            S.bank.balance+=revenue; 
            
            S.phones.currentOrder=null;
            S.phones.nextOrderCheck=Math.floor(Math.random()*180)+30; 
            
            uUI();
        };
        // --- ููุงูุฉ ูุธุงุฆู ุณูู ุงูููุงุชู ---

        let minuteCounter=0;
        function gameTick(){
            if(S.breakTimer>0){S.breakTimer--;if(S.breakTimer>0){uUI();return;}}
            if(S.flashSale.active){S.flashSale.timer--;if(S.flashSale.timer<=0){S.flashSale.active=!1;S.flashSale.nextMinute=minuteCounter+Math.floor(Math.random()*(FLASH_SALE_MAX_WAIT-FLASH_SALE_MIN_WAIT+1))+FLASH_SALE_MIN_WAIT;alert('๐ฅ ุงูุชูู ุตุนูุฏ ุงูุฃุณุนุงุฑุ ุนุงุฏ ุงูุณูู ูุทุจูุนุชู.');}}
            if(S.isStrike){uUI();return;}
            S.machines.filter(m=>m.isPower).forEach(p=>{if(p.failureTime>0){p.failureTime--;}});
            S.m-=S.w*.1;
            if(S.debt>0&&S.loanA>0&&(Date.now()%1e4<1e3)){S.debt+=S.debt*S.loanA*(10/60);}
            const stats=getMachineStats();
            if(stats.machinesRunning>0){const efficiency=(1+((S.factoryLvl-1)*.01))*1.1; for(const machine of stats.machinesToRun){S.p+=(machine.pPerMin/60)*efficiency;}}
            if(S.bigLoan.active&&S.bigLoan.timer>0){S.bigLoan.timer--;} 
            if(S.bigLoan.active&&S.bigLoan.timer<=0&&S.bigLoan.totalRepay>0){S.bigLoan.active=!1;alert('๐ด ุงูุชูู ููุช ุณุฏุงุฏ ุงููุฑุถ ุงููุจูุฑ! ูุฌุจ ุงุชุฎุงุฐ ูุฑุงุฑ.');}
            
            S.cOwned.forEach(car=>{
                if(car[5]===0&&car[4]>0){
                    if(car[6]>0){
                        car[6]--;
                    }else{
                        car[5]=generateOfferValue(car[2]);
                        car[6]=generateNextOfferTime();
                        addMailMessage('ุนุฑุถ ุณูุงุฑุฉ', `ููุงู ุนุฑุถ ุฌุฏูุฏ ุนูู ุณูุงุฑุฉ ${car[1]}.`); 
                    }
                }
            });
            
            S.farm.forEach((crop, index)=>{
                if(!crop.ready&&crop.timer>0){
                    crop.timer--;
                    if(crop.timer<=0){
                        crop.ready=!0;
                        addMailMessage('ุญุตุงุฏ ูุฒุฑุนุฉ (ุฌุงูุฒ)', `ุงููุญุตูู #${index + 1} ุฌุงูุฒ ููุญุตุงุฏ.`); 
                    }
                }
            });

            S.shipments.forEach((s, index) => {
                s.timer--;
                if (s.timer <= 0) {
                    S.phones.parts += s.count;
                    S.phones.batteries += s.count;
                    addMailMessage('ุดุญูุฉ ูุงุชู (ูุตูู)', `ุชู ูุตูู ุดุญูุฉ ${s.count} ุชุฌููุนุฉ ููููุงุช.`); 
                    S.shipments.splice(index, 1);
                }
            });

            S.phones.production.forEach((p, index) => {
                p.timer--;
                if (p.timer <= 0) {
                    S.phones.stock++;
                    S.phones.production.splice(index, 1);
                }
            });

            if (S.phones.currentOrder) {
                S.phones.currentOrder.timer--;
                if (S.phones.currentOrder.timer <= 0) {
                    S.phones.currentOrder = null;
                    S.phones.nextOrderCheck = Math.floor(Math.random() * 180) + 30;
                }
            } else {
                S.phones.nextOrderCheck--;
                if (S.phones.nextOrderCheck <= 0) {
                    generateNewOrder();
                }
            }
            
            // ๐ ุชุญุฏูุซ ุงููุฑูุถ ุงูุฏูููุฉ ุงููุดุทุฉ (ูู)
            S.internationalLoans.myActiveLoans.forEach((loan, index) => {
                loan.timer--;
                if (loan.timer <= 0) {
                    S.bank.balance += loan.totalRepay;
                    S.internationalLoans.myActiveLoans.splice(index, 1);
                    alert(`๐ ุชู ุณุฏุงุฏ ูุฑุถ ${loan.country}! ุงูุฅุฌูุงูู: ${formatNumber(loan.totalRepay)}$ ููุจูู ุงููุฑูุฒู.`);
                }
            });

            checkAchievements();uUI();
        }
        let loanOfferTimer = 0; // ูุคูุช ูุทูุจ ุงููุฑุถ ุงูุฏููู
        function minuteTick(){
            minuteCounter++;
            S.eOwned.forEach(e=>{S.bankP+=e[2];});
            
            if (S.blackMarket) updateBlackMarketStatus(); 

            if(S.w>0){
                 S.morale=Math.max(0,S.morale-MORALE_DROP_PER_MIN);
                 if(S.morale<=25&&!S.isStrike){S.isStrike=!0;alert('๐ด ุงูุฎูุถ ุฑุถุง ุงูุนูุงู ุฅูู ูุง ุฏูู 25%! ุจุฏุฃ ุงูุฅุถุฑุงุจ. ุชููู ุงูุฅูุชุงุฌ. ุงุฏูุน ููุทุนุงู ูุฅููุงุฆู.');}
            }
            if(!S.flashSale.active&&minuteCounter>=S.flashSale.nextMinute){S.flashSale.active=!0;S.flashSale.timer=FLASH_SALE_DURATION;alert('๐ ุจุฏุฃุช ูุชุฑุฉ ุตุนูุฏ ุงูุฃุณุนุงุฑ! ุชุญููู 100P ูููุญู 10$ ุงูุขู!');}
            if(minuteCounter%10===0){
                S.machines.filter(m=>m.isPower).forEach(p=>{if(p.failureTime<=0&&Math.random()<.05){p.failureTime=60;alert(`๐จ ุนุทู ููุงุฌุฆ ูู ุงููููุฏ ุงูููุฑุจุงุฆู! ุชููู ููุฏุฉ ุฏูููุฉ ูุงุญุฏุฉ.`);}});
            }
            if(minuteCounter%15===0&&S.w>0){S.breakTimer=Math.floor(Math.random()*(120-30+1))+30;}

            if (S.phones.stock > 0) {
                const totalMaintenanceCost = S.phones.stock * S.phones.maintenanceCost;
                if (S.m >= totalMaintenanceCost) {
                    S.m -= totalMaintenanceCost;
                } else {
                    S.m = 0;
                }
            }
            
            // ๐ ุทูุจ ูุฑุถ ุฏููู ุฌุฏูุฏ ูู 3-7 ุฏูุงุฆู
            loanOfferTimer++;
            if(loanOfferTimer >= (Math.floor(Math.random() * 5) + 3)){
                 generateInternationalLoanOffer();
                 loanOfferTimer = 0;
            }

            uUI();
        }

        window.changeView=v=>{
             const views=['view-home','view-game','view-car','view-estate','view-achievements','view-bank','view-farm','view-phones','view-black-market'];
             views.forEach(id=>{const el=$(id);if(el)el.classList.add('hidden');});
             const targetEl=$(v);if(targetEl)targetEl.classList.remove('hidden');
             S.currentView=v;uUI();
        };
        $('feedWorkerBtn').onclick=()=>{ 
             if(S.w===0){alert('ูุง ููุฌุฏ ุนูุงู ูุฅุทุนุงููู!');return;}
             if(S.m<FOOD_COST){alert('ุงูุฑุตูุฏ ุบูุฑ ูุงูู ูุตุฑู 100$ ููุทุนุงู.');return;}
             S.m-=FOOD_COST;S.morale=100;
             if(S.isStrike){S.isStrike=!1;alert('โ ุชู ุฏูุน ุทุนุงู ุงูุนูุงู! ุนุงุฏ ุงูุนูุงู ููุนูู.');} 
             else{alert('โ ุชู ุตุฑู ุงูุทุนุงู! ุฑุถุง ุงูุนูุงู ุงูุขู 100%.');}
             uUI();
        };
        $('collectBtn').onclick=()=>{ S.p+=1; uUI(); }; 
        $('convertBtn').onclick=()=>{
            const currentPToM=S.flashSale.active?FLASH_SALE_P_TO_M:BASE_P_TO_M;const currentConversionRate=100/currentPToM; 
            const units=Math.floor(S.p/100); 
            if(units>0){S.m+=units*currentConversionRate;S.p-=units*100;alert(`ุชู ุชุญููู ${formatNumber(units*100,0)} ููุทุฉ ุฅูู ${formatNumber(units*currentConversionRate,2)}$ ุฑุตูุฏ.`);}
            else{alert('ูุง ููุฌุฏ ููุงุท ูุงููุฉ ููุชุญููู (ุชุญุชุงุฌ 100P).')}
            uUI(); 
        };
        $('buyWorkerBtn').onclick=()=>{if(S.m>=W_COST){S.m-=W_COST;S.w+=1;uUI();}};
        $('collectBankPBtn').onclick=()=>{if(S.bankP>0){S.p+=S.bankP;S.bankP=0;}uUI();};
        $('upgradeFactoryBtn').onclick=()=>{
             if(S.m>=S.upgradeCost){S.m-=S.upgradeCost;S.factoryLvl++;S.upgradeCost*=1.07;alert(`โ ุชูุช ุชุฑููุฉ ุงููุนูู ูููุณุชูู ${S.factoryLvl}! ุฒุงุฏุช ููุงุกุฉ ุงูุฅูุชุงุฌ 1%.`);uUI();}
             else{alert('ูุง ููุฌุฏ ุฑุตูุฏ ูุงูู ููุชุฑููุฉ.');}
        };
        window.buyItem=(id,isPower)=>{
            const itemBase=MACHINES.find(m=>m.id===id&&m.isPower===isPower);
            if(!itemBase||S.m<itemBase.cost)return;S.m-=itemBase.cost;
            if(isPower){S.machines.push({...itemBase,count:1,failureTime:0});}
            else{const existing=S.machines.find(sm=>sm.id===id&&!sm.isPower);if(existing){existing.count++;}else{S.machines.push({...itemBase,count:1});}}
            uUI();
        };
        window.buyEstate=id=>{const e=ESTATES.find(e=>e.id===id);if(e&&S.m>=e.price){S.m-=e.price;S.eOwned.push([e.id,e.name,e.rentPerMin,e.price]);}uUI();};
        window.buyCar=id=>{const car=CARS.find(c=>c.id===id);if(S.cOwned.some(car=>car[0]===id)){alert(`ูุฏูู ุจุงููุนู ุณูุงุฑุฉ ูู ููุน ${car.name}.`);return;}
            if(car&&S.m>=car.price){S.m-=car.price;S.cOwned.push([car.id,car.name,car.price,0,5,0,generateNextOfferTime()]);}uUI();};
        window.acceptOffer=id=>{
             const carIndex=S.cOwned.findIndex(c=>c[0]===id&&c[5]>0);
             if(carIndex!==-1){
                 const car=S.cOwned[carIndex];
                 const profit=car[5]-car[2];
                 S.bank.balance+=car[5];
                 S.carProfit+=profit;
                 S.cOwned.splice(carIndex,1);
                 alert(`โ ุชู ุจูุน ${car[1]} ููุงุจู ${formatNumber(car[5],0)}$ (${formatNumber(profit,0)}$ ุฑุจุญ ุตุงูู). ุงููุจูุบ ูู ุงูุจูู ุงููุฑูุฒู.`);
                 uUI();
             }
        };
        window.rejectOffer=id=>{
             const carIndex=S.cOwned.findIndex(c=>c[0]===id&&c[5]>0);
             if(carIndex!==-1){const car=S.cOwned[carIndex];car[5]=0;car[4]--;car[3]++; 
             if(car[4]<=0){S.cOwned.splice(carIndex,1);addMailMessage('ูุตุงุฏุฑุฉ ุณูุงุฑุฉ', `โ ุชูุช ูุตุงุฏุฑุฉ ุงูุณูุงุฑุฉ ${car[1]} ูุฑูุถ ุงูุนุฑุถ ุงูุฃุฎูุฑ.`);}else{car[6]=generateNextOfferTime();}uUI();}
        };
        window.resetCarProfit=()=>{
             if(S.carProfit===0)return;
             S.carProfit=0;
             alert('โ ุชู ุฅุนุงุฏุฉ ุชุนููู ุนุฏุงุฏ ุฃุฑุจุงุญ ุงูุณูุงุฑุงุช.');
             uUI();
        };
        window.toggleAdmin=()=>{
             const pass=$('adminPass').value;
             if(pass===S.adminPass){S.admin=!S.admin;$('adminControls').classList.toggle('hidden',!S.admin);$('adminBtn').textContent=S.admin?'ุฎุฑูุฌ':'ุฏุฎูู';alert(S.admin?'ูุถุน ุงูุฃุฏูู ููุนู.':'ุชู ุงูุฎุฑูุฌ ูู ูุถุน ุงูุฃุฏูู.');}
             else{alert('ูููุฉ ุงูุณุฑ ุบูุฑ ุตุญูุญุฉ.');}
        };
        window.applyCheat=type=>{
             if(!S.admin)return;const amount=parseFloat($('cheatAmount').value);
             if(isNaN(amount)||amount<=0)return;
             if(type==='money'){S.m+=amount;alert(`ุชู ุฅุถุงูุฉ ${amount}$ ุฑุตูุฏ.`);}
             if(type==='points'){S.p+=amount;alert(`ุชู ุฅุถุงูุฉ ${amount} ููุทุฉ.`);}
             uUI();
        };
        window.checkAndClaimAchievement=id=>{
             const ach=ACHIEVEMENTS.find(a=>a.id===id);
             if(ach&&!S.achievements[id]&&ach.check()){S.achievements[id]=!0;S.m+=ach.reward;}
             else if(S.achievements[id]){alert('โ ุชู ุงุณุชูุงู ูุฐุง ุงูุฅูุฌุงุฒ ูุณุจูุงู.');}
             else{alert('โ ูู ูุชู ุงุณุชููุงุก ุดุฑูุท ูุฐุง ุงูุฅูุฌุงุฒ ุจุนุฏ.');}uUI();
        };
        window.transferMoney=transferMoney;window.plantSeeds=plantSeeds;window.harvest=harvest;

        document.addEventListener('DOMContentLoaded',()=>{
             const initialViewsToHide=['view-game','view-car','view-estate','view-achievements','view-bank','view-farm','view-phones','view-black-market'];
             initialViewsToHide.forEach(id=>{const el=$(id);if(el)el.classList.add('hidden');});
             $('view-home').classList.remove('hidden');
            S.flashSale.nextMinute=Math.floor(Math.random()*(FLASH_SALE_MAX_WAIT-FLASH_SALE_MIN_WAIT+1))+FLASH_SALE_MIN_WAIT; 
            uUI();
        });
        setInterval(gameTick,1e3); 
        setInterval(minuteTick,6e4);
    </script>
</body>
</html>
